<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBdiag å‘½ä»¤ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        #subSubCommandGroup {
            display: none !important;
        }

        #subSubCommandGroup[style*="block"] {
            display: block !important;
        }

        #subSubSubCommandGroup {
            display: none !important;
        }

        #subSubSubCommandGroup[style*="block"] {
            display: block !important;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .command-output {
            margin-top: 20px;
            padding: 20px;
            background: #1e1e1e;
            border-radius: 8px;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }

        .copy-btn {
            margin-top: 10px;
            background: #28a745;
            color: white;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .node-list {
            margin-top: 10px;
        }

        .node-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .node-item input {
            flex: 1;
        }

        .add-node-btn {
            background: #17a2b8;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
        }

        .remove-node-btn {
            background: #dc3545;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        .help-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .db-env-container {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .db-env-container .form-group {
            margin-bottom: 10px;
        }

        .db-env-container label {
            font-size: 14px;
            font-weight: 500;
        }

        .db-env-container input {
            margin-top: 5px;
        }

        /* Tooltip æ ·å¼ */
        .tooltip-wrapper {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-left: 5px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            font-weight: bold;
            vertical-align: middle;
        }

        .tooltip-content {
            visibility: hidden;
            opacity: 0;
            position: fixed;
            z-index: 10000;
            background-color: #333;
            color: #fff;
            padding: 12px;
            border-radius: 6px;
            width: 350px;
            max-width: 90vw;
            font-size: 13px;
            line-height: 1.6;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: opacity 0.3s, visibility 0.3s;
            pointer-events: none;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .tooltip-content {
                width: 280px;
                font-size: 12px;
            }
        }

        .tooltip-content::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
            pointer-events: none;
        }

        .tooltip-wrapper:hover .tooltip-content,
        .tooltip-wrapper.active .tooltip-content {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #fff;
            border-bottom: 1px solid #555;
            padding-bottom: 5px;
        }

        .tooltip-example {
            background: #1a1a1a;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
        }

        .tooltip-param {
            margin: 5px 0;
        }

        .tooltip-param strong {
            color: #4CAF50;
        }

        .validation-error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }

        input:invalid {
            border-color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ OBdiag å‘½ä»¤ç”Ÿæˆå™¨</h1>
            <p>æ ¹æ®æ‚¨çš„éœ€æ±‚è‡ªåŠ¨ç”Ÿæˆ obdiag è¯Šæ–­å‘½ä»¤</p>
            <p style="font-size: 0.9em; opacity: 0.85; margin-top: 10px;">
                <span style="background: rgba(255, 255, 255, 0.2); padding: 4px 12px; border-radius: 12px;">
                    ğŸ“Œ æœ¬å·¥å…·é€‚é… obdiag 4.1.0 ç‰ˆæœ¬
                </span>
            </p>
        </div>

        <div class="content">
            <!-- ç‰ˆæœ¬æç¤º -->
            <div class="alert" style="background: #e7f3ff; color: #004085; border: 1px solid #b3d7ff; padding: 12px; border-radius: 6px; margin-bottom: 20px;">
                <strong>ğŸ“Œ ç‰ˆæœ¬è¯´æ˜ï¼š</strong>æœ¬å‘½ä»¤ç”ŸæˆåŠ©æ‰‹é€‚é… <strong>obdiag 4.1.0</strong> ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯å…¶ä»–ç‰ˆæœ¬ï¼Œéƒ¨åˆ†å‘½ä»¤å‚æ•°å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œè¯·å‚è€ƒå¯¹åº”ç‰ˆæœ¬çš„æ–‡æ¡£ã€‚
            </div>
            
            <!-- ä¸»å‘½ä»¤é€‰æ‹© -->
            <div class="section">
                <div class="section-title">1. é€‰æ‹©åŠŸèƒ½</div>
                <div class="form-group">
                    <label for="mainCommand">ä¸»å‘½ä»¤
                        <span class="tooltip-wrapper">
                            <span class="tooltip-icon">?</span>
                            <div class="tooltip-content">
                                <div class="tooltip-title">å‘½ä»¤è¯´æ˜</div>
                                <div>é€‰æ‹©è¦æ‰§è¡Œçš„ obdiag ä¸»å‘½ä»¤ï¼š</div>
                                <div class="tooltip-param"><strong>gather</strong>: æ”¶é›†è¯Šæ–­ä¿¡æ¯</div>
                                <div class="tooltip-param"><strong>display</strong>: æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯</div>
                                <div class="tooltip-param"><strong>analyze</strong>: åˆ†ææ—¥å¿—å’Œæ•°æ®</div>
                                <div class="tooltip-param"><strong>check</strong>: æ£€æŸ¥é›†ç¾¤</div>
                                <div class="tooltip-param"><strong>rca</strong>: æ ¹å› åˆ†æ</div>
                            </div>
                        </span>
                    </label>
                    <select id="mainCommand">
                        <option value="">è¯·é€‰æ‹©...</option>
                        <option value="gather">gather - æ”¶é›†è¯Šæ–­ä¿¡æ¯</option>
                        <option value="display">display - æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯</option>
                        <option value="analyze">analyze - åˆ†ææ—¥å¿—å’Œæ•°æ®</option>
                        <option value="check">check - æ£€æŸ¥é›†ç¾¤</option>
                        <option value="rca">rca - æ ¹å› åˆ†æ</option>
                        <option value="config">config - å¿«é€Ÿæ„å»ºé…ç½®</option>
                        <option value="update">update - æ›´æ–°æ’ä»¶</option>
                        <option value="tool">tool - å·¥å…·</option>
                        <option value="display-trace">display-trace - æ˜¾ç¤ºtraceæ—¥å¿—</option>
                    </select>
                </div>
                <div class="form-group" id="subCommandGroup" style="display: none;">
                    <label for="subCommand">å­å‘½ä»¤
                        <span class="tooltip-wrapper" id="subCommandTooltip" style="display: none;">
                            <span class="tooltip-icon">?</span>
                            <div class="tooltip-content" id="subCommandTooltipContent"></div>
                        </span>
                    </label>
                    <select id="subCommand" onchange="updateSubSubCommands(); updateSubCommandTooltip();"></select>
                </div>
                <div class="form-group" id="subSubCommandGroup" style="display: none;">
                    <label for="subSubCommand">ä¸‰çº§å‘½ä»¤
                        <span class="tooltip-wrapper" id="subSubCommandTooltip" style="display: none;">
                            <span class="tooltip-icon">?</span>
                            <div class="tooltip-content" id="subSubCommandTooltipContent"></div>
                        </span>
                    </label>
                    <select id="subSubCommand" onchange="updateSubSubSubCommands(); updateSubSubCommandTooltip();"></select>
                </div>
                <div class="form-group" id="subSubSubCommandGroup" style="display: none;">
                    <label for="subSubSubCommand">å››çº§å‘½ä»¤ï¼ˆåœºæ™¯é€‰æ‹©ï¼‰
                        <span class="tooltip-wrapper" id="subSubSubCommandTooltip" style="display: none;">
                            <span class="tooltip-icon">?</span>
                            <div class="tooltip-content" id="subSubSubCommandTooltipContent"></div>
                        </span>
                    </label>
                    <select id="subSubSubCommand" onchange="updateCommandOptions(); updateSubSubSubCommandTooltip();"></select>
                </div>
            </div>

            <!-- æ•°æ®åº“è¿æ¥é…ç½® -->
            <div class="section">
                <div class="section-title">2. æ•°æ®åº“è¿æ¥é…ç½®</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dbHost">æ•°æ®åº“ä¸»æœº (db_host)</label>
                        <input type="text" id="dbHost" placeholder="ä¾‹å¦‚: 192.168.1.1">
                    </div>
                    <div class="form-group">
                        <label for="dbPort">æ•°æ®åº“ç«¯å£ (db_port)</label>
                        <input type="number" id="dbPort" placeholder="ä¾‹å¦‚: 2881">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dbUser">ç³»ç»Ÿç§Ÿæˆ·ç”¨æˆ· (tenant_sys.user)</label>
                        <input type="text" id="dbUser" placeholder="ä¾‹å¦‚: root@sys">
                    </div>
                    <div class="form-group">
                        <label for="dbPassword">ç³»ç»Ÿç§Ÿæˆ·å¯†ç  (tenant_sys.password)</label>
                        <input type="password" id="dbPassword" placeholder="è¾“å…¥å¯†ç ">
                    </div>
                </div>
            </div>

            <!-- Observer èŠ‚ç‚¹é…ç½® -->
            <div class="section">
                <div class="section-title">3. Observer èŠ‚ç‚¹é…ç½®</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="observerSshUsername">SSH ç”¨æˆ·å (obcluster.servers.global.ssh_username)</label>
                        <input type="text" id="observerSshUsername" placeholder="ä¾‹å¦‚: admin">
                    </div>
                    <div class="form-group">
                        <label for="observerSshPassword">SSH å¯†ç  (obcluster.servers.global.ssh_password)</label>
                        <input type="password" id="observerSshPassword" placeholder="è¾“å…¥å¯†ç ï¼ˆå¯é€‰ï¼‰">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="observerSshKeyFile">SSH å¯†é’¥æ–‡ä»¶ (obcluster.servers.global.ssh_key_file)</label>
                        <input type="text" id="observerSshKeyFile" placeholder="ä¾‹å¦‚: ~/.ssh/id_rsa">
                        <div class="help-text">å¦‚æœæœåŠ¡å™¨åªæ”¯æŒå…¬é’¥è®¤è¯ï¼Œå¿…é¡»å¡«å†™æ­¤é€‰é¡¹</div>
                    </div>
                    <div class="form-group">
                        <label for="observerSshPort">SSH ç«¯å£ (obcluster.servers.global.ssh_port)</label>
                        <input type="number" id="observerSshPort" placeholder="é»˜è®¤: 22" value="22">
                    </div>
                </div>
                <div class="form-group">
                    <label for="observerHomePath">Home è·¯å¾„ (obcluster.servers.global.home_path)</label>
                    <input type="text" id="observerHomePath" placeholder="ä¾‹å¦‚: /home/admin/oceanbase">
                </div>
                <div class="form-group">
                    <label>Observer èŠ‚ç‚¹ IP åˆ—è¡¨</label>
                    <div id="observerNodes" class="node-list">
                        <div class="node-item">
                            <input type="text" class="node-ip" placeholder="èŠ‚ç‚¹ IP åœ°å€">
                            <input type="text" class="node-data-dir" placeholder="data_dir (å¯é€‰)">
                            <input type="text" class="node-redo-dir" placeholder="redo_dir (å¯é€‰)">
                            <button type="button" class="btn remove-node-btn" onclick="removeObserverNode(this)">åˆ é™¤</button>
                        </div>
                    </div>
                    <button type="button" class="btn add-node-btn" onclick="addObserverNode()">æ·»åŠ èŠ‚ç‚¹</button>
                </div>
            </div>

            <!-- OBProxy èŠ‚ç‚¹é…ç½® -->
            <div class="section">
                <div class="section-title">4. OBProxy èŠ‚ç‚¹é…ç½®ï¼ˆå¯é€‰ï¼‰</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="obproxySshUsername">SSH ç”¨æˆ·å (obproxy.servers.global.ssh_username)</label>
                        <input type="text" id="obproxySshUsername" placeholder="ä¾‹å¦‚: admin">
                    </div>
                    <div class="form-group">
                        <label for="obproxySshPassword">SSH å¯†ç  (obproxy.servers.global.ssh_password)</label>
                        <input type="password" id="obproxySshPassword" placeholder="è¾“å…¥å¯†ç ï¼ˆå¯é€‰ï¼‰">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="obproxySshKeyFile">SSH å¯†é’¥æ–‡ä»¶ (obproxy.servers.global.ssh_key_file)</label>
                        <input type="text" id="obproxySshKeyFile" placeholder="ä¾‹å¦‚: ~/.ssh/id_rsa">
                    </div>
                    <div class="form-group">
                        <label for="obproxyHomePath">Home è·¯å¾„ (obproxy.servers.global.home_path)</label>
                        <input type="text" id="obproxyHomePath" placeholder="ä¾‹å¦‚: /home/admin/obproxy">
                    </div>
                </div>
                <div class="form-group">
                    <label>OBProxy èŠ‚ç‚¹ IP åˆ—è¡¨</label>
                    <div id="obproxyNodes" class="node-list">
                        <div class="node-item">
                            <input type="text" class="proxy-node-ip" placeholder="èŠ‚ç‚¹ IP åœ°å€">
                            <button type="button" class="btn remove-node-btn" onclick="removeObproxyNode(this)">åˆ é™¤</button>
                        </div>
                    </div>
                    <button type="button" class="btn add-node-btn" onclick="addObproxyNode()">æ·»åŠ èŠ‚ç‚¹</button>
                </div>
            </div>

            <!-- å‘½ä»¤ç‰¹å®šå‚æ•° -->
            <div class="section" id="commandSpecificOptions">
                <div class="section-title">5. å‘½ä»¤ç‰¹å®šå‚æ•°</div>
                <div id="commandOptions"></div>
            </div>

            <!-- ç”Ÿæˆå‘½ä»¤ -->
            <div class="section">
                <div class="section-title">6. ç”Ÿæˆçš„å‘½ä»¤</div>
                <div id="commandOutput" class="command-output">è¯·é€‰æ‹©åŠŸèƒ½å¹¶å¡«å†™é…ç½®...</div>
                <button type="button" class="btn copy-btn" onclick="copyCommand()">ğŸ“‹ å¤åˆ¶å‘½ä»¤</button>
                <div id="copyAlert" class="alert alert-success hidden">å‘½ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼</div>
            </div>
        </div>
    </div>

    <script>
        // å­å‘½ä»¤åŠŸèƒ½è¯´æ˜
        const subCommandDescriptions = {
            'gather.all': 'æ”¶é›†æ‰€æœ‰è¯Šæ–­ä¿¡æ¯ï¼ˆæ—¥å¿—ã€ç³»ç»ŸçŠ¶æ€ã€å †æ ˆç­‰ï¼‰',
            'gather.log': 'æ”¶é›† OceanBase æ—¥å¿—',
            'gather.sysstat': 'æ”¶é›†ç³»ç»ŸçŠ¶æ€ä¿¡æ¯',
            'gather.stack': 'æ”¶é›†å †æ ˆä¿¡æ¯',
            'gather.perf': 'æ”¶é›†æ€§èƒ½åˆ†ææ•°æ®',
            'gather.slog': 'æ”¶é›†ç³»ç»Ÿæ—¥å¿—',
            'gather.clog': 'æ”¶é›†æäº¤æ—¥å¿—',
            'gather.plan_monitor': 'æ”¶é›† ParalleSQL æ‰§è¡Œè®¡åˆ’ç›‘æ§ä¿¡æ¯',
            'gather.awr': 'æ”¶é›† AWR æŠ¥å‘Š',
            'gather.obproxy_log': 'æ”¶é›† OBProxy æ—¥å¿—',
            'gather.oms_log': 'æ”¶é›† OMS æ—¥å¿—',
            'gather.scene': 'ä½¿ç”¨åœºæ™¯æ–¹å¼æ”¶é›†è¯Šæ–­ä¿¡æ¯',
            'gather.ash': 'æ”¶é›† Active Session History ä¿¡æ¯',
            'gather.tabledump': 'å¯¼å‡ºè¡¨æ•°æ®',
            'gather.parameter': 'æ”¶é›†å‚æ•°ä¿¡æ¯',
            'gather.variable': 'æ”¶é›†å˜é‡ä¿¡æ¯',
            'gather.dbms_xplan': 'æ”¶é›†æ‰§è¡Œè®¡åˆ’ä¿¡æ¯',
            'gather.core': 'æ”¶é›† core æ–‡ä»¶',
            'display.scene': 'ä½¿ç”¨åœºæ™¯æ–¹å¼æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯',
            'analyze.log': 'åˆ†ææ—¥å¿—æ–‡ä»¶',
            'analyze.flt_trace': 'åˆ†æ FLT trace ä¿¡æ¯',
            'analyze.parameter': 'åˆ†æå‚æ•°é…ç½®',
            'analyze.variable': 'åˆ†æå˜é‡é…ç½®',
            'analyze.queue': 'åˆ†æé˜Ÿåˆ—ä¿¡æ¯',
            'analyze.index_space': 'åˆ†æç´¢å¼•ç©ºé—´',
            'analyze.memory': 'åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ',
            'check.run': 'è¿è¡Œé›†ç¾¤æ£€æŸ¥ä»»åŠ¡',
            'check.list': 'åˆ—å‡ºå¯ç”¨çš„æ£€æŸ¥ä»»åŠ¡',
            'rca.run': 'è¿è¡Œæ ¹å› åˆ†æåœºæ™¯',
            'rca.list': 'åˆ—å‡ºå¯ç”¨çš„æ ¹å› åˆ†æåœºæ™¯'
        };

        // RCA åœºæ™¯åˆ—è¡¨ï¼ˆå¸¸è§åœºæ™¯ï¼‰
        const rcaScenes = {
            'lock_conflict': { name: 'lock_conflict', description: 'é”å†²çªé—®é¢˜æ’æŸ¥' },
            'major_hold': { name: 'major_hold', description: 'åˆå¹¶å¡ä½é—®é¢˜æ’æŸ¥' },
            'tenant_memory_throttling': { name: 'tenant_memory_throttling', description: 'ç§Ÿæˆ·å†…å­˜é™é€Ÿé—®é¢˜æ’æŸ¥' },
            'log_error': { name: 'log_error', description: 'æ—¥å¿—ç›¸å…³é—®é¢˜æ’æŸ¥' },
            'memory_full': { name: 'memory_full', description: 'å†…å­˜çˆ†é—®é¢˜æ’æŸ¥' },
            'replay_hold': { name: 'replay_hold', description: 'å›æ”¾å¡ä½é—®é¢˜æ’æŸ¥' },
            'disconnection': { name: 'disconnection', description: 'è¿æ¥æ–­å¼€é—®é¢˜æ’æŸ¥' },
            'suspend_transaction': { name: 'suspend_transaction', description: 'äº‹åŠ¡æŒ‚èµ·é—®é¢˜æ’æŸ¥' },
            'schema_leak': { name: 'schema_leak', description: 'Schema æ³„æ¼é—®é¢˜æ’æŸ¥' },
            'transaction_wait_timeout': { name: 'transaction_wait_timeout', description: 'äº‹åŠ¡ç­‰å¾…è¶…æ—¶é—®é¢˜æ’æŸ¥' },
            'transaction_rollback': { name: 'transaction_rollback', description: 'äº‹åŠ¡å›æ»šé—®é¢˜æ’æŸ¥' },
            'transaction_execute_timeout': { name: 'transaction_execute_timeout', description: 'äº‹åŠ¡æ‰§è¡Œè¶…æ—¶é—®é¢˜æ’æŸ¥' },
            'transaction_disconnection': { name: 'transaction_disconnection', description: 'äº‹åŠ¡è¿æ¥æ–­å¼€é—®é¢˜æ’æŸ¥' },
            'transaction_not_ending': { name: 'transaction_not_ending', description: 'äº‹åŠ¡æœªç»“æŸé—®é¢˜æ’æŸ¥' },
            'transaction_other_error': { name: 'transaction_other_error', description: 'äº‹åŠ¡å…¶ä»–é”™è¯¯é—®é¢˜æ’æŸ¥' },
            'ddl_failure': { name: 'ddl_failure', description: 'DDL å¤±è´¥é—®é¢˜æ’æŸ¥' },
            'ddl_disk_full': { name: 'ddl_disk_full', description: 'DDL ç£ç›˜æ»¡é—®é¢˜æ’æŸ¥' },
            'clog_disk_full': { name: 'clog_disk_full', description: 'Clog ç£ç›˜æ»¡é—®é¢˜æ’æŸ¥' },
            'index_ddl_error': { name: 'index_ddl_error', description: 'ç´¢å¼• DDL é”™è¯¯é—®é¢˜æ’æŸ¥' },
            'split_schedule_error': { name: 'split_schedule_error', description: 'åˆ†è£‚è°ƒåº¦é”™è¯¯é—®é¢˜æ’æŸ¥' },
            'delete_server_error': { name: 'delete_server_error', description: 'åˆ é™¤æœåŠ¡å™¨é”™è¯¯é—®é¢˜æ’æŸ¥' },
            'unit_gc': { name: 'unit_gc', description: 'Unit GC é—®é¢˜æ’æŸ¥' },
            'gc_troubleshooting': { name: 'gc_troubleshooting', description: 'GC é—®é¢˜æ’æŸ¥' },
            'weak_read_troubleshooting': { name: 'weak_read_troubleshooting', description: 'å¼±è¯»é—®é¢˜æ’æŸ¥' },
            'oms_obcdc': { name: 'oms_obcdc', description: 'OMS OBCDC é—®é¢˜æ’æŸ¥' },
            'oms_full_trans': { name: 'oms_full_trans', description: 'OMS å…¨é‡äº‹åŠ¡é—®é¢˜æ’æŸ¥' }
        };

        // Gather Scene åœºæ™¯åˆ—è¡¨ï¼ˆåŒ…å«å¿…éœ€çš„ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼‰
        const gatherScenes = {
            // Observer åœºæ™¯
            'observer.base': { 
                name: 'observer.base', 
                description: 'é›†ç¾¤åŸºç¡€ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.compaction': { 
                name: 'observer.compaction', 
                description: 'åˆå¹¶é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.clog_disk_full': { 
                name: 'observer.clog_disk_full', 
                description: 'Clog ç£ç›˜æ»¡',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.cluster_down': { 
                name: 'observer.cluster_down', 
                description: 'é›†ç¾¤å®•æœº',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.delay_of_primary_and_backup': { 
                name: 'observer.delay_of_primary_and_backup', 
                description: 'ä¸»å¤‡å»¶è¿Ÿ',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.io': { 
                name: 'observer.io', 
                description: 'IO é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.log_archive': { 
                name: 'observer.log_archive', 
                description: 'æ—¥å¿—å½’æ¡£é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.long_transaction': { 
                name: 'observer.long_transaction', 
                description: 'é•¿äº‹åŠ¡é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.memory': { 
                name: 'observer.memory', 
                description: 'å†…å­˜é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.recovery': { 
                name: 'observer.recovery', 
                description: 'æ¢å¤é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.restart': { 
                name: 'observer.restart', 
                description: 'é‡å¯é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.rootservice_switch': { 
                name: 'observer.rootservice_switch', 
                description: 'RootService åˆ‡æ¢',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.suspend_transaction': { 
                name: 'observer.suspend_transaction', 
                description: 'äº‹åŠ¡æŒ‚èµ·',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.topsql': { 
                name: 'observer.topsql', 
                description: 'TopSQL é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.unknown': { 
                name: 'observer.unknown', 
                description: 'æœªçŸ¥é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.unit_data_imbalance': { 
                name: 'observer.unit_data_imbalance', 
                description: 'Unit æ•°æ®ä¸å¹³è¡¡',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.backup': { 
                name: 'observer.backup', 
                description: 'å¤‡ä»½é—®é¢˜',
                requiredEnv: ['tenant_id'],
                optionalEnv: []
            },
            'observer.backup_clean': { 
                name: 'observer.backup_clean', 
                description: 'å¤‡ä»½æ¸…ç†',
                requiredEnv: ['tenant_id'],
                optionalEnv: []
            },
            // Observer ç¡¬ç¼–ç åœºæ™¯
            'observer.perf_sql': { 
                name: 'observer.perf_sql', 
                description: 'SQLæ€§èƒ½é—®é¢˜',
                requiredEnv: ['host', 'port', 'user', 'password', 'database', 'trace_id'],
                optionalEnv: []
            },
            'observer.sql_err': { 
                name: 'observer.sql_err', 
                description: 'SQLæ‰§è¡Œå‡ºé”™',
                requiredEnv: ['host', 'port', 'user', 'password', 'database', 'trace_id'],
                optionalEnv: []
            },
            'observer.cpu_high': { 
                name: 'observer.cpu_high', 
                description: 'CPUé«˜',
                requiredEnv: [],
                optionalEnv: ['perf_count']
            },
            'observer.px_collect_log': { 
                name: 'observer.px_collect_log', 
                description: 'SQL PX æ”¶é›†æŠ¥é”™æºèŠ‚ç‚¹æ—¥å¿—',
                requiredEnv: ['trace_id'],
                optionalEnv: ['estimated_time']
            },
            'observer.rollback_transaction': { 
                name: 'observer.rollback_transaction', 
                description: 'å›æ»šäº‹åŠ¡æ”¶é›†',
                requiredEnv: [],
                optionalEnv: ['from_time', 'to_time', 'since']
            },
            // OBProxy åœºæ™¯
            'obproxy.restart': { 
                name: 'obproxy.restart', 
                description: 'OBProxy æ— æ•…é‡å¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'obproxy.obproxy_parameter': { 
                name: 'obproxy.obproxy_parameter', 
                description: 'OBProxy å‚æ•°é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            },
            // Other åœºæ™¯
            'other.application_error': { 
                name: 'other.application_error', 
                description: 'åº”ç”¨æŠ¥é”™é—®é¢˜',
                requiredEnv: [],
                optionalEnv: []
            }
        };

        // Display Scene åœºæ™¯åˆ—è¡¨ï¼ˆåŒ…å«å¿…éœ€çš„ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼‰
        const displayScenes = {
            // Observer åœºæ™¯
            'observer.cluster_info': { 
                name: 'observer.cluster_info', 
                description: 'é›†ç¾¤ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.all_tenant': { 
                name: 'observer.all_tenant', 
                description: 'æ‰€æœ‰ç§Ÿæˆ·ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.tenant_info': { 
                name: 'observer.tenant_info', 
                description: 'ç§Ÿæˆ·ä¿¡æ¯',
                requiredEnv: ['tenant_name'],
                optionalEnv: []
            },
            'observer.zone_info': { 
                name: 'observer.zone_info', 
                description: 'Zone ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.server_info': { 
                name: 'observer.server_info', 
                description: 'æœåŠ¡å™¨ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.unit_info': { 
                name: 'observer.unit_info', 
                description: 'Unit ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.memory': { 
                name: 'observer.memory', 
                description: 'å†…å­˜ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.cpu': { 
                name: 'observer.cpu', 
                description: 'CPU ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.compaction': { 
                name: 'observer.compaction', 
                description: 'åˆå¹¶ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.clog_volume_statistics': { 
                name: 'observer.clog_volume_statistics', 
                description: 'Clog å®¹é‡ç»Ÿè®¡',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.topsql': { 
                name: 'observer.topsql', 
                description: 'TopSQL',
                requiredEnv: ['tenant_name'],
                optionalEnv: ['mtime']
            },
            'observer.slowsql': { 
                name: 'observer.slowsql', 
                description: 'æ…¢SQL',
                requiredEnv: ['tenant_name'],
                optionalEnv: ['mtime']
            },
            'observer.plan': { 
                name: 'observer.plan', 
                description: 'æ‰§è¡Œè®¡åˆ’',
                requiredEnv: ['tenant_name', 'sqlid'],
                optionalEnv: []
            },
            'observer.plan_explain': { 
                name: 'observer.plan_explain', 
                description: 'æ‰§è¡Œè®¡åˆ’è§£é‡Š',
                requiredEnv: ['svr_ip', 'svr_port', 'tenant_id', 'plan_id'],
                optionalEnv: []
            },
            'observer.processlist': { 
                name: 'observer.processlist', 
                description: 'è¿›ç¨‹åˆ—è¡¨',
                requiredEnv: ['tenant_name'],
                optionalEnv: []
            },
            'observer.processlist_stat': { 
                name: 'observer.processlist_stat', 
                description: 'è¿›ç¨‹ç»Ÿè®¡',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.long_transaction': { 
                name: 'observer.long_transaction', 
                description: 'é•¿äº‹åŠ¡',
                requiredEnv: [],
                optionalEnv: ['wait_time']
            },
            'observer.lockholder': { 
                name: 'observer.lockholder', 
                description: 'é”æŒæœ‰è€…',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.lock_table': { 
                name: 'observer.lock_table', 
                description: 'é”è¡¨ä¿¡æ¯',
                requiredEnv: ['tablename'],
                optionalEnv: []
            },
            'observer.leader': { 
                name: 'observer.leader', 
                description: 'Leader ä¿¡æ¯',
                requiredEnv: ['level'],
                optionalEnv: []
            },
            'observer.rs': { 
                name: 'observer.rs', 
                description: 'RootService ä¿¡æ¯',
                requiredEnv: [],
                optionalEnv: []
            },
            'observer.event': { 
                name: 'observer.event', 
                description: 'äº‹ä»¶ä¿¡æ¯',
                requiredEnv: ['tenant_name'],
                optionalEnv: []
            },
            'observer.database_datasize': { 
                name: 'observer.database_datasize', 
                description: 'æ•°æ®åº“æ•°æ®å¤§å°',
                requiredEnv: ['tenant_id', 'database_name'],
                optionalEnv: []
            },
            'observer.table_datasize': { 
                name: 'observer.table_datasize', 
                description: 'è¡¨æ•°æ®å¤§å°',
                requiredEnv: ['tenant_id', 'database_name', 'table_name'],
                optionalEnv: []
            },
            'observer.table_info': { 
                name: 'observer.table_info', 
                description: 'è¡¨ä¿¡æ¯',
                requiredEnv: ['host', 'port', 'user', 'password', 'database', 'database_name', 'table_name'],
                optionalEnv: []
            },
            'observer.table_ndv': { 
                name: 'observer.table_ndv', 
                description: 'è¡¨ NDV',
                requiredEnv: ['database_name', 'table_name'],
                optionalEnv: []
            },
            'observer.index': { 
                name: 'observer.index', 
                description: 'ç´¢å¼•ä¿¡æ¯',
                requiredEnv: ['database_name', 'table_name'],
                optionalEnv: []
            },
            'observer.storage_method': { 
                name: 'observer.storage_method', 
                description: 'å­˜å‚¨æ–¹å¼',
                requiredEnv: ['tenant_name', 'database_name'],
                optionalEnv: []
            },
            'observer.inner_table': { 
                name: 'observer.inner_table', 
                description: 'å†…éƒ¨è¡¨ä¿¡æ¯',
                requiredEnv: ['tablename'],
                optionalEnv: []
            }
        };

        // å‘½ä»¤ç»“æ„å®šä¹‰
        const commandStructure = {
            gather: {
                all: { options: ['from', 'to', 'since', 'grep', 'store_dir', 'temp_dir'] },
                log: { options: ['from', 'to', 'since', 'scope', 'grep', 'store_dir', 'temp_dir', 'recent_count', 'redact'] },
                sysstat: { options: ['store_dir'] },
                stack: { options: ['store_dir'] },
                perf: { options: ['store_dir', 'scope', 'count'] },
                slog: { options: ['from', 'to', 'since', 'store_dir'] },
                clog: { options: ['from', 'to', 'since', 'store_dir'] },
                plan_monitor: { options: ['trace_id', 'store_dir', 'env_db', 'env_custom', 'skip'], required: ['env_db'] },
                awr: { options: ['cluster_name', 'cluster_id', 'from', 'to', 'since', 'store_dir'] },
                obproxy_log: { options: ['from', 'to', 'since', 'scope', 'grep', 'store_dir', 'recent_count'] },
                oms_log: { options: ['from', 'to', 'since', 'scope', 'grep', 'store_dir', 'temp_dir', 'recent_count', 'oms_component_id'] },
                scene: { 
                    list: { options: [], description: 'æ˜¾ç¤ºå¯ç”¨çš„æ”¶é›†åœºæ™¯åˆ—è¡¨' },
                    run: { options: ['scene', 'from', 'to', 'since', 'env_db', 'env_custom', 'store_dir', 'temp_dir', 'skip_type', 'redact'], required: ['scene'], description: 'è¿è¡ŒæŒ‡å®šçš„æ”¶é›†åœºæ™¯' }
                },
                ash: { options: ['trace_id', 'sql_id', 'wait_class', 'report_type', 'from', 'to', 'store_dir', 'svr_ip', 'svr_port', 'tenant_id'] },
                tabledump: { options: ['database', 'table', 'user', 'password', 'store_dir'] },
                parameter: { options: ['store_dir'] },
                variable: { options: ['store_dir'] },
                dbms_xplan: { options: ['trace_id', 'scope', 'user', 'password', 'store_dir', 'env_db', 'env_custom'], required: ['env_db'] },
                core: { options: ['from', 'to', 'since', 'store_dir'] }
            },
            display: {
                scene: {
                    list: { options: [], description: 'æ˜¾ç¤ºå¯ç”¨çš„åœºæ™¯åˆ—è¡¨' },
                    run: { options: ['scene', 'from', 'to', 'since', 'env_db', 'env_custom'], required: ['scene'], description: 'è¿è¡ŒæŒ‡å®šçš„æ˜¾ç¤ºåœºæ™¯' }
                }
            },
            analyze: {
                log: { options: ['from', 'to', 'scope', 'grep', 'log_level', 'files', 'store_dir', 'since', 'temp_dir', 'tenant_id'] },
                flt_trace: { options: ['flt_trace_id', 'files', 'top', 'recursion', 'output', 'store_dir', 'temp_dir'] },
                parameter: {
                    diff: { options: ['file', 'store_dir'] },
                    default: { options: ['file', 'store_dir'] }
                },
                variable: {
                    diff: { options: ['file', 'store_dir'] }
                },
                queue: { options: ['from', 'to', 'store_dir', 'since', 'tenant', 'queue'] },
                index_space: { options: ['tenant_name', 'database', 'table_name', 'index_name', 'column_names'] },
                memory: { options: ['from', 'to', 'files', 'store_dir', 'since', 'temp_dir', 'version'] }
            },
            check: {
                run: { options: ['cases', 'obproxy_cases', 'observer_tasks', 'obproxy_tasks', 'store_dir', 'report_type', 'env'] },
                list: { options: ['all'] }
            },
            rca: {
                run: {
                    // å°†åœºæ™¯ä½œä¸ºä¸‰çº§å‘½ä»¤
                    lock_conflict: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'é”å†²çªé—®é¢˜æ’æŸ¥' },
                    major_hold: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'åˆå¹¶å¡ä½é—®é¢˜æ’æŸ¥' },
                    tenant_memory_throttling: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'ç§Ÿæˆ·å†…å­˜é™é€Ÿé—®é¢˜æ’æŸ¥' },
                    log_error: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'æ—¥å¿—ç›¸å…³é—®é¢˜æ’æŸ¥' },
                    memory_full: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'å†…å­˜çˆ†é—®é¢˜æ’æŸ¥' },
                    replay_hold: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'å›æ”¾å¡ä½é—®é¢˜æ’æŸ¥' },
                    disconnection: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'è¿æ¥æ–­å¼€é—®é¢˜æ’æŸ¥' },
                    suspend_transaction: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'äº‹åŠ¡æŒ‚èµ·é—®é¢˜æ’æŸ¥' },
                    schema_leak: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'Schema æ³„æ¼é—®é¢˜æ’æŸ¥' },
                    transaction_wait_timeout: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'äº‹åŠ¡ç­‰å¾…è¶…æ—¶é—®é¢˜æ’æŸ¥' },
                    transaction_rollback: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'äº‹åŠ¡å›æ»šé—®é¢˜æ’æŸ¥' },
                    transaction_execute_timeout: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'äº‹åŠ¡æ‰§è¡Œè¶…æ—¶é—®é¢˜æ’æŸ¥' },
                    transaction_disconnection: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'äº‹åŠ¡è¿æ¥æ–­å¼€é—®é¢˜æ’æŸ¥' },
                    transaction_not_ending: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'äº‹åŠ¡æœªç»“æŸé—®é¢˜æ’æŸ¥' },
                    transaction_other_error: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'äº‹åŠ¡å…¶ä»–é”™è¯¯é—®é¢˜æ’æŸ¥' },
                    ddl_failure: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'DDL å¤±è´¥é—®é¢˜æ’æŸ¥' },
                    ddl_disk_full: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'DDL ç£ç›˜æ»¡é—®é¢˜æ’æŸ¥' },
                    clog_disk_full: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'Clog ç£ç›˜æ»¡é—®é¢˜æ’æŸ¥' },
                    index_ddl_error: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'ç´¢å¼• DDL é”™è¯¯é—®é¢˜æ’æŸ¥' },
                    split_schedule_error: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'åˆ†è£‚è°ƒåº¦é”™è¯¯é—®é¢˜æ’æŸ¥' },
                    delete_server_error: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'åˆ é™¤æœåŠ¡å™¨é”™è¯¯é—®é¢˜æ’æŸ¥' },
                    unit_gc: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'Unit GC é—®é¢˜æ’æŸ¥' },
                    gc_troubleshooting: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'GC é—®é¢˜æ’æŸ¥' },
                    weak_read_troubleshooting: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'å¼±è¯»é—®é¢˜æ’æŸ¥' },
                    oms_obcdc: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'OMS OBCDC é—®é¢˜æ’æŸ¥' },
                    oms_full_trans: { options: ['store_dir', 'env_db', 'env_custom', 'report_type'], description: 'OMS å…¨é‡äº‹åŠ¡é—®é¢˜æ’æŸ¥' },
                    // ä¿ç•™åŸæœ‰çš„ scene é€‰é¡¹ä½œä¸ºå¤‡é€‰ï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰
                    _manual_scene: { options: ['scene', 'store_dir', 'env_db', 'env_custom', 'report_type'], required: ['scene'], description: 'æ‰‹åŠ¨è¾“å…¥åœºæ™¯åç§°' }
                },
                list: { options: [] }
            },
            config: { options: ['h', 'u', 'p', 'P'] },
            update: { options: ['file', 'force'] },
            tool: {
                crypto_config: { options: ['key', 'file', 'encrypted_file'] },
                io_performance: { options: ['disk', 'date'] },
                ai_assistant: { options: [] },
                config_check: { options: [] }
            },
            'display-trace': { options: ['trace_id'] }
        };

        // å‘½ä»¤è¯´æ˜æ–‡æ¡£
        const commandHelp = {
            'gather': {
                description: 'æ”¶é›† OceanBase è¯Šæ–­ä¿¡æ¯',
                examples: [
                    'obdiag gather log --from "2024-01-01 00:00:00" --to "2024-01-01 23:59:59"',
                    'obdiag gather all --since 1h --grep ERROR',
                    'obdiag gather plan_monitor --trace_id xxx --env host=127.0.0.1 --env port=2881'
                ]
            },
            'gather.log': {
                description: 'æ”¶é›† OceanBase æ—¥å¿—',
                params: {
                    '--from': 'å¼€å§‹æ—¶é—´ï¼Œæ ¼å¼: yyyy-mm-dd hh:mm:ss',
                    '--to': 'ç»“æŸæ—¶é—´ï¼Œæ ¼å¼: yyyy-mm-dd hh:mm:ss',
                    '--since': 'æ—¶é—´èŒƒå›´ï¼Œæ ¼å¼: <n><m|h|d>ï¼Œä¾‹å¦‚: 1h, 30m, 2d',
                    '--scope': 'æ—¥å¿—ç±»å‹ï¼Œå¯é€‰: observer, election, rootservice, all',
                    '--grep': 'å…³é”®è¯è¿‡æ»¤ï¼Œå¯å¤šæ¬¡ä½¿ç”¨',
                    '--store_dir': 'å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤: ./'
                },
                example: 'obdiag gather log --since 1h --scope observer --grep ERROR --grep WARN'
            },
            'gather.plan_monitor': {
                description: 'æ”¶é›† ParalleSQL ä¿¡æ¯',
                params: {
                    '--trace_id': 'SQL trace IDï¼ˆå¯é€‰ï¼‰',
                    '--env': 'æ•°æ®åº“è¿æ¥å‚æ•°ï¼ˆå¿…å¡«ï¼‰ï¼Œéœ€è¦: host, port, user, password, database',
                    '--store_dir': 'å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤: ./',
                    '--skip': 'è·³è¿‡ç±»å‹ï¼Œå¯é€‰: dbms_xplan'
                },
                example: 'obdiag gather plan_monitor --env host=127.0.0.1 --env port=2881 --env user=test@test --env password=****** --env database=test'
            },
            'gather.scene.list': {
                description: 'æ˜¾ç¤ºå¯ç”¨çš„æ”¶é›†åœºæ™¯åˆ—è¡¨',
                example: 'obdiag gather scene list'
            },
            'gather.scene.run': {
                description: 'è¿è¡ŒæŒ‡å®šçš„æ”¶é›†åœºæ™¯',
                params: {
                    '--scene': 'åœºæ™¯åç§°ï¼ˆå¿…å¡«ï¼‰',
                    '--from': 'å¼€å§‹æ—¶é—´ï¼Œæ ¼å¼: yyyy-mm-dd hh:mm:ss',
                    '--to': 'ç»“æŸæ—¶é—´ï¼Œæ ¼å¼: yyyy-mm-dd hh:mm:ss',
                    '--since': 'æ—¶é—´èŒƒå›´ï¼Œæ ¼å¼: <n><m|h|d>',
                    '--env': 'ç¯å¢ƒå˜é‡ï¼Œæ ¼å¼: key=valueï¼Œå¯å¤šæ¬¡ä½¿ç”¨',
                    '--store_dir': 'å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤: ./'
                },
                example: 'obdiag gather scene run --scene sql_err --env trace_id=xxx --env host=127.0.0.1 --env port=2881'
            },
            'display.scene.list': {
                description: 'æ˜¾ç¤ºå¯ç”¨çš„æ˜¾ç¤ºåœºæ™¯åˆ—è¡¨',
                example: 'obdiag display scene list'
            },
            'display.scene.run': {
                description: 'è¿è¡ŒæŒ‡å®šçš„æ˜¾ç¤ºåœºæ™¯',
                params: {
                    '--scene': 'åœºæ™¯åç§°ï¼ˆå¿…å¡«ï¼‰',
                    '--from': 'å¼€å§‹æ—¶é—´ï¼Œæ ¼å¼: yyyy-mm-dd hh:mm:ss',
                    '--to': 'ç»“æŸæ—¶é—´ï¼Œæ ¼å¼: yyyy-mm-dd hh:mm:ss',
                    '--since': 'æ—¶é—´èŒƒå›´ï¼Œæ ¼å¼: <n><m|h|d>',
                    '--env': 'ç¯å¢ƒå˜é‡ï¼Œæ ¼å¼: key=valueï¼Œå¯å¤šæ¬¡ä½¿ç”¨'
                },
                example: 'obdiag display scene run --scene cluster_info --since 1h'
            },
            'check.run': {
                description: 'æ£€æŸ¥ OceanBase é›†ç¾¤',
                params: {
                    '--cases': "æ£€æŸ¥ observer çš„æ¡ˆä¾‹",
                    '--obproxy_cases': "æ£€æŸ¥ obproxy çš„æ¡ˆä¾‹",
                    '--observer_tasks': 'é€‰æ‹© observer ä»»åŠ¡',
                    '--obproxy_tasks': 'é€‰æ‹© obproxy ä»»åŠ¡',
                    '--store_dir': 'å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤: ./check_report/',
                    '--report_type': 'æŠ¥å‘Šç±»å‹: table, json, xml, yaml, html'
                },
                example: 'obdiag check run --cases all --report_type html'
            }
        };

        // é€‰é¡¹è¯´æ˜
        const optionDescriptions = {
            from: { label: 'å¼€å§‹æ—¶é—´ (--from)', placeholder: "æ ¼å¼: 'yyyy-mm-dd hh:mm:ss'", type: 'text', help: "æŒ‡å®šæ—¶é—´èŒƒå›´çš„å¼€å§‹æ—¶é—´ï¼Œæ ¼å¼: 'yyyy-mm-dd hh:mm:ss'ï¼Œä¾‹å¦‚: '2024-01-01 00:00:00'" },
            to: { label: 'ç»“æŸæ—¶é—´ (--to)', placeholder: "æ ¼å¼: 'yyyy-mm-dd hh:mm:ss'", type: 'text', help: "æŒ‡å®šæ—¶é—´èŒƒå›´çš„ç»“æŸæ—¶é—´ï¼Œæ ¼å¼: 'yyyy-mm-dd hh:mm:ss'ï¼Œä¾‹å¦‚: '2024-01-01 23:59:59'" },
            since: { label: 'æ—¶é—´èŒƒå›´ (--since)', placeholder: "ä¾‹å¦‚: 1h, 30m, 2d", type: 'text', help: "æŒ‡å®šä»å½“å‰æ—¶é—´å¾€å‰çš„æ—¶é—´èŒƒå›´ï¼Œæ ¼å¼: <n><m|h|d>ï¼Œm=åˆ†é’Ÿï¼Œh=å°æ—¶ï¼Œd=å¤©ã€‚ä¾‹å¦‚: 1h (1å°æ—¶å‰åˆ°ç°åœ¨), 30m (30åˆ†é’Ÿå‰åˆ°ç°åœ¨), 2d (2å¤©å‰åˆ°ç°åœ¨)" },
            grep: { label: 'å…³é”®è¯è¿‡æ»¤ (--grep)', placeholder: 'æ ¼å¼: å…³é”®è¯', type: 'multi', multiple: true, help: 'ç”¨äºè¿‡æ»¤æ—¥å¿—ä¸­çš„å…³é”®è¯ï¼Œå¯ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚ä¾‹å¦‚: --grep ERROR --grep WARN ä¼šåŒæ—¶è¿‡æ»¤åŒ…å« ERROR æˆ– WARN çš„æ—¥å¿—' },
            store_dir: { label: 'å­˜å‚¨ç›®å½• (--store_dir)', placeholder: 'é»˜è®¤: ./', type: 'text', help: 'å­˜å‚¨æ”¶é›†ç»“æœçš„ç›®å½•è·¯å¾„ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•ï¼ˆ./ï¼‰ã€‚ä¾‹å¦‚: --store_dir /tmp/obdiag_result' },
            temp_dir: { label: 'ä¸´æ—¶ç›®å½• (--temp_dir)', placeholder: 'é»˜è®¤: /tmp', type: 'text', help: 'åœ¨èŠ‚ç‚¹ä¸Šä¸´æ—¶å­˜å‚¨æ–‡ä»¶çš„ç›®å½•ï¼Œé»˜è®¤æ˜¯ /tmpã€‚ç¡®ä¿è¯¥ç›®å½•æœ‰è¶³å¤Ÿçš„ç©ºé—´å’Œå†™å…¥æƒé™' },
            scope: { label: 'èŒƒå›´ (--scope)', placeholder: 'æ ¹æ®å‘½ä»¤ä¸åŒè€Œä¸åŒ', type: 'text', help: 'æ ¹æ®å‘½ä»¤ä¸åŒï¼Œå¯é€‰å€¼ä¹Ÿä¸åŒã€‚å¯¹äº log å‘½ä»¤: observer, election, rootservice, allï¼›å¯¹äº perf å‘½ä»¤: sample, flame, pstack, allï¼›å¯¹äº obproxy_log å‘½ä»¤: obproxy, obproxy_limit, obproxy_stat, obproxy_digest, obproxy_slow, obproxy_diagnosis, obproxy_error, all' },
            recent_count: { label: 'æœ€è¿‘æ–‡ä»¶æ•° (--recent_count)', placeholder: 'é»˜è®¤: 0', type: 'number', help: 'åªæ”¶é›†æœ€è¿‘ N ä¸ªæ—¥å¿—æ–‡ä»¶ã€‚é»˜è®¤å€¼ä¸º 0ï¼ˆç¦ç”¨ï¼‰ã€‚å½“ > 0 æ—¶ï¼Œåªä¼šæ”¶é›†æœ€è¿‘ N ä¸ªæ–‡ä»¶ï¼Œfrom/to/since å‚æ•°å°†è¢«å¿½ç•¥' },
            redact: { label: 'è„±æ•é€‰é¡¹ (--redact)', placeholder: 'è„±æ•é…ç½®', type: 'text', help: 'æ•°æ®è„±æ•é€‰é¡¹ï¼Œç”¨äºéšè—æ•æ„Ÿä¿¡æ¯ã€‚å¯ä»¥é…ç½®éœ€è¦è„±æ•çš„å­—æ®µæˆ–æ¨¡å¼' },
            trace_id: { label: 'Trace ID', placeholder: 'Trace ID (display-traceå‘½ä»¤éœ€è¦)', type: 'text', help: 'SQL trace IDï¼Œç”¨äºè¿½è¸ªç‰¹å®šçš„ SQL æ‰§è¡Œã€‚å¯¹äº plan_monitor å‘½ä»¤ï¼Œtrace_id æ˜¯å¯é€‰çš„ï¼›å¯¹äº display-trace å‘½ä»¤ï¼Œtrace_id æ˜¯å¿…å¡«çš„ä½ç½®å‚æ•°' },
            skip: { label: 'è·³è¿‡ç±»å‹ (--skip)', placeholder: 'ä¾‹å¦‚: dbms_xplan', type: 'text' },
            env: { label: 'ç¯å¢ƒå˜é‡ (--env)', placeholder: 'æ ¼å¼: key=value', type: 'multi', multiple: true },
            env_db: { label: 'æ•°æ®åº“è¿æ¥ç¯å¢ƒå˜é‡ (--env)', placeholder: 'æ•°æ®åº“è¿æ¥å‚æ•°', type: 'db_env', required: true, help: 'æ•°æ®åº“è¿æ¥å‚æ•°ï¼ˆå¿…å¡«ï¼‰ï¼Œéœ€è¦å¡«å†™: hostï¼ˆä¸»æœºåœ°å€ï¼‰ã€portï¼ˆç«¯å£ï¼‰ã€userï¼ˆç”¨æˆ·åï¼Œæ ¼å¼: user@tenantï¼‰ã€passwordï¼ˆå¯†ç ï¼‰ã€databaseï¼ˆæ•°æ®åº“åï¼‰ã€‚ä¾‹å¦‚: --env host=127.0.0.1 --env port=2881 --env user=test@test --env password=****** --env database=test' },
            env_custom: { label: 'è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ (--env)', placeholder: 'æ ¼å¼: key=value', type: 'multi', multiple: true, help: 'è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ï¼Œæ ¼å¼: key=valueã€‚å¯ä»¥å¤šæ¬¡ä½¿ç”¨æ·»åŠ å¤šä¸ªç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚: --env trace_id=xxx --env tenant_id=1' },
            skip: { label: 'è·³è¿‡ç±»å‹ (--skip)', placeholder: 'ä¾‹å¦‚: dbms_xplan', type: 'text' },
            cluster_name: { label: 'é›†ç¾¤åç§° (--cluster_name)', placeholder: 'OCPé›†ç¾¤åç§°', type: 'text' },
            cluster_id: { label: 'é›†ç¾¤ID (--cluster_id)', placeholder: 'OCPé›†ç¾¤ID', type: 'text' },
            oms_component_id: { label: 'OMSç»„ä»¶ID (--oms_component_id)', placeholder: 'æ ¼å¼: x.x.x.x-123', type: 'text' },
            scene: { label: 'åœºæ™¯åç§° (--scene)', placeholder: 'è¯·é€‰æ‹©åœºæ™¯', type: 'select', options: null, required: false, help: 'åœºæ™¯åç§°ã€‚å¯ä»¥ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è¾“å…¥å…¶ä»–åœºæ™¯åç§°ã€‚å¯ä»¥ä½¿ç”¨ "obdiag gather scene list" æˆ– "obdiag display scene list" æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„åœºæ™¯åˆ—è¡¨' },
            skip_type: { label: 'è·³è¿‡ç±»å‹ (--skip_type)', placeholder: 'choices=[ssh, sql]', type: 'text', help: 'è·³è¿‡æŸäº›ç±»å‹çš„æ”¶é›†ï¼Œå¯é€‰å€¼: sshï¼ˆè·³è¿‡SSHæ”¶é›†ï¼‰ã€sqlï¼ˆè·³è¿‡SQLæ”¶é›†ï¼‰ã€‚ä¾‹å¦‚: --skip_type ssh ä¼šè·³è¿‡æ‰€æœ‰SSHç›¸å…³çš„æ”¶é›†æ“ä½œ' },
            sql_id: { label: 'SQL ID (--sql_id)', placeholder: 'SQL ID', type: 'text' },
            wait_class: { label: 'ç­‰å¾…ç±»å‹ (--wait_class)', placeholder: 'äº‹ä»¶ç±»å‹', type: 'text' },
            report_type: { label: 'æŠ¥å‘Šç±»å‹ (--report_type)', placeholder: 'table/json/xml/yaml/html', type: 'text', help: 'æŠ¥å‘Šçš„è¾“å‡ºæ ¼å¼ï¼Œå¯é€‰å€¼: tableï¼ˆè¡¨æ ¼ï¼Œé»˜è®¤ï¼‰ã€jsonã€xmlã€yamlã€htmlã€‚table æ ¼å¼é€‚åˆç»ˆç«¯æŸ¥çœ‹ï¼Œhtml æ ¼å¼é€‚åˆæµè§ˆå™¨æŸ¥çœ‹' },
            svr_ip: { label: 'æœåŠ¡å™¨IP (--svr_ip)', placeholder: 'éœ€è¦4.3.5.0æˆ–æ›´é«˜ç‰ˆæœ¬', type: 'text' },
            svr_port: { label: 'æœåŠ¡å™¨ç«¯å£ (--svr_port)', placeholder: 'éœ€è¦4.3.5.0æˆ–æ›´é«˜ç‰ˆæœ¬', type: 'text' },
            tenant_id: { label: 'ç§Ÿæˆ·ID (--tenant_id)', placeholder: 'éœ€è¦4.3.5.0æˆ–æ›´é«˜ç‰ˆæœ¬', type: 'text' },
            database: { label: 'æ•°æ®åº“å (--database)', placeholder: 'æ•°æ®åº“åç§°', type: 'text' },
            table: { label: 'è¡¨å (--table)', placeholder: 'è¡¨åç§°', type: 'text' },
            user: { label: 'ç”¨æˆ·å (--user)', placeholder: 'æ•°æ®åº“ç”¨æˆ·å', type: 'text' },
            password: { label: 'å¯†ç  (--password)', placeholder: 'æ•°æ®åº“å¯†ç ', type: 'password' },
            count: { label: 'é‡‡æ ·æ¬¡æ•° (--count)', placeholder: '>= 1000000', type: 'number' },
            log_level: { label: 'æ—¥å¿—çº§åˆ« (--log_level)', placeholder: 'DEBUG/TRACE/INFO/WDIAG/WARN/EDIAG/ERROR', type: 'text' },
            files: { label: 'æ–‡ä»¶åˆ—è¡¨ (--files)', placeholder: 'æ–‡ä»¶è·¯å¾„', type: 'multi', multiple: true, help: 'æŒ‡å®šè¦åˆ†æçš„æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥å¤šæ¬¡ä½¿ç”¨æŒ‡å®šå¤šä¸ªæ–‡ä»¶ã€‚ä¸»è¦ç”¨äºç¦»çº¿åˆ†æåœºæ™¯ã€‚ä¾‹å¦‚: --files /path/to/log1.log --files /path/to/log2.log' },
            top: { label: 'Topæ•°é‡ (--top)', placeholder: 'é»˜è®¤: 5', type: 'number' },
            recursion: { label: 'é€’å½’æ·±åº¦ (--recursion)', placeholder: 'é»˜è®¤: 8', type: 'number' },
            output: { label: 'è¾“å‡ºæ ¼å¼ (--output)', placeholder: 'é»˜è®¤: 60', type: 'number' },
            file: { label: 'æ–‡ä»¶è·¯å¾„ (--file)', placeholder: 'æ–‡ä»¶è·¯å¾„', type: 'text' },
            tenant_name: { label: 'ç§Ÿæˆ·å (--tenant_name)', placeholder: 'ç§Ÿæˆ·åç§°', type: 'text' },
            table_name: { label: 'è¡¨å (--table_name)', placeholder: 'è¡¨åç§°', type: 'text' },
            index_name: { label: 'ç´¢å¼•å (--index_name)', placeholder: 'ç´¢å¼•åç§°', type: 'text' },
            column_names: { label: 'åˆ—å (--column_names)', placeholder: 'ä¾‹å¦‚: c1,c2,c3', type: 'text' },
            host: { label: 'ä¸»æœº (--host)', placeholder: 'è¿æ¥ä¸»æœº', type: 'text' },
            port: { label: 'ç«¯å£ (--port)', placeholder: 'è¿æ¥ç«¯å£', type: 'text' },
            level: { label: 'å‘Šè­¦çº§åˆ« (--level)', placeholder: 'critical/warn/notice/ok', type: 'text' },
            limit: { label: 'é™åˆ¶æ•°é‡ (--limit)', placeholder: 'é»˜è®¤: 2000', type: 'number' },
            elapsed_time: { label: 'æ‰§è¡Œæ—¶é—´é˜ˆå€¼ (--elapsed_time)', placeholder: 'å¾®ç§’ï¼Œé»˜è®¤: 100000', type: 'number' },
            cases: { label: 'æ£€æŸ¥æ¡ˆä¾‹ (--cases)', placeholder: "observer's cases", type: 'text' },
            obproxy_cases: { label: 'OBProxyæ¡ˆä¾‹ (--obproxy_cases)', placeholder: "obproxy's cases", type: 'text' },
            observer_tasks: { label: 'Observerä»»åŠ¡ (--observer_tasks)', placeholder: 'observer tasks', type: 'text' },
            obproxy_tasks: { label: 'OBProxyä»»åŠ¡ (--obproxy_tasks)', placeholder: 'obproxy tasks', type: 'text' },
            queue: { label: 'é˜Ÿåˆ—å¤§å° (--queue)', placeholder: 'é»˜è®¤: 50', type: 'number' },
            version: { label: 'ç‰ˆæœ¬ (--version)', placeholder: 'OceanBaseç‰ˆæœ¬', type: 'text' },
            h: { label: 'æ•°æ®åº“ä¸»æœº (-h)', placeholder: 'æ•°æ®åº“ä¸»æœº', type: 'text' },
            u: { label: 'ç³»ç»Ÿç”¨æˆ· (-u)', placeholder: 'é»˜è®¤: root@sys', type: 'text' },
            p: { label: 'å¯†ç  (-p)', placeholder: 'å¯†ç ', type: 'password' },
            P: { label: 'ç«¯å£ (-P)', placeholder: 'ç«¯å£', type: 'text' },
            force: { label: 'å¼ºåˆ¶æ›´æ–° (--force)', placeholder: '', type: 'checkbox' },
            key: { label: 'å¯†é’¥ (--key)', placeholder: 'åŠ å¯†/è§£å¯†å¯†é’¥', type: 'text' },
            encrypted_file: { label: 'åŠ å¯†æ–‡ä»¶ (--encrypted_file)', placeholder: 'åŠ å¯†æ–‡ä»¶è·¯å¾„', type: 'text' },
            disk: { label: 'ç£ç›˜è®¾å¤‡ (--disk)', placeholder: 'ä¾‹å¦‚: sda, sdb, clog, data', type: 'text' },
            date: { label: 'æ—¥æœŸ (--date)', placeholder: 'æ ¼å¼: YYYYMMDD', type: 'text' },
            all: { label: 'æ˜¾ç¤ºå…¨éƒ¨ (--all)', placeholder: '', type: 'checkbox' }
        };

        // æ ¼å¼éªŒè¯å‡½æ•°
        function validateIP(ip) {
            const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
            if (!ipRegex.test(ip)) return false;
            const parts = ip.split('.');
            return parts.every(part => {
                const num = parseInt(part, 10);
                return num >= 0 && num <= 255;
            });
        }

        function validateUsername(username) {
            // ç”¨æˆ·åä¸èƒ½æ˜¯IPåœ°å€æ ¼å¼
            if (validateIP(username)) {
                return { valid: false, message: 'ç”¨æˆ·åä¸èƒ½æ˜¯IPåœ°å€æ ¼å¼' };
            }
            // ç”¨æˆ·åé€šå¸¸åªåŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦
            const usernameRegex = /^[a-zA-Z0-9_-]+$/;
            if (!usernameRegex.test(username)) {
                return { valid: false, message: 'ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦' };
            }
            return { valid: true };
        }

        function validatePort(port) {
            const portNum = parseInt(port, 10);
            return portNum >= 1 && portNum <= 65535;
        }

        function showValidationError(input, message) {
            // ç§»é™¤ä¹‹å‰çš„é”™è¯¯æç¤º
            const existingError = input.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
            
            // æ·»åŠ é”™è¯¯æ ·å¼
            input.style.borderColor = '#dc3545';
            
            // æ·»åŠ é”™è¯¯æç¤º
            const errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error';
            errorDiv.style.color = '#dc3545';
            errorDiv.style.fontSize = '12px';
            errorDiv.style.marginTop = '5px';
            errorDiv.textContent = 'âš ï¸ ' + message;
            input.parentElement.appendChild(errorDiv);
        }

        function clearValidationError(input) {
            input.style.borderColor = '';
            const existingError = input.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
        }

        function updateSubCommands() {
            const mainCmd = document.getElementById('mainCommand').value;
            const subCmdGroup = document.getElementById('subCommandGroup');
            const subSubCmdGroup = document.getElementById('subSubCommandGroup');
            const subCmdSelect = document.getElementById('subCommand');
            
            subCmdSelect.innerHTML = '';
            subSubCmdGroup.style.display = 'none';
            document.getElementById('subSubCommand').innerHTML = '';
            
            if (!mainCmd || !commandStructure[mainCmd]) {
                subCmdGroup.style.display = 'none';
                updateCommandOutput();
                return;
            }

            const subCommands = commandStructure[mainCmd];
            
            if (typeof subCommands === 'object' && !subCommands.options) {
                // æœ‰å­å‘½ä»¤
                subCmdGroup.style.display = 'block';
                subCmdSelect.innerHTML = '<option value="">è¯·é€‰æ‹©...</option>';
                
                for (const [key, value] of Object.entries(subCommands)) {
                    const option = document.createElement('option');
                    option.value = key;
                    // æ·»åŠ åŠŸèƒ½è¯´æ˜
                    const descKey = `${mainCmd}.${key}`;
                    const description = subCommandDescriptions[descKey] || '';
                    option.textContent = description ? `${key} - ${description}` : key;
                    subCmdSelect.appendChild(option);
                }
            } else {
                // æ²¡æœ‰å­å‘½ä»¤
                subCmdGroup.style.display = 'none';
            }
            
            updateSubSubCommands();
        }

        function updateSubCommandTooltip() {
            const mainCmd = document.getElementById('mainCommand').value;
            const subCmd = document.getElementById('subCommand').value;
            const tooltipWrapper = document.getElementById('subCommandTooltip');
            const tooltipContent = document.getElementById('subCommandTooltipContent');
            
            if (!mainCmd || !subCmd) {
                tooltipWrapper.style.display = 'none';
                return;
            }
            
            const helpKey = `${mainCmd}.${subCmd}`;
            const help = commandHelp[helpKey];
            
            if (help) {
                tooltipWrapper.style.display = 'inline-block';
                let html = `<div class="tooltip-title">${help.description || subCmd}</div>`;
                
                if (help.params) {
                    html += '<div style="margin-top: 8px;"><strong>å‚æ•°è¯´æ˜ï¼š</strong></div>';
                    for (const [param, desc] of Object.entries(help.params)) {
                        html += `<div class="tooltip-param"><strong>${param}</strong>: ${desc}</div>`;
                    }
                }
                
                if (help.example) {
                    html += `<div class="tooltip-example" style="margin-top: 10px;"><strong>ç¤ºä¾‹ï¼š</strong><br>${help.example}</div>`;
                }
                
                tooltipContent.innerHTML = html;
            } else {
                tooltipWrapper.style.display = 'none';
            }
        }

        function updateSubSubCommands() {
            const mainCmd = document.getElementById('mainCommand').value;
            const subCmd = document.getElementById('subCommand').value;
            const subSubCmdGroup = document.getElementById('subSubCommandGroup');
            const subSubCmdSelect = document.getElementById('subSubCommand');
            
            subSubCmdSelect.innerHTML = '';
            
            // å¦‚æœæ²¡æœ‰ä¸»å‘½ä»¤æˆ–å­å‘½ä»¤ï¼Œéšè—ä¸‰çº§å‘½ä»¤é€‰æ‹©æ¡†
            if (!mainCmd || !subCmd) {
                subSubCmdGroup.style.display = 'none';
                updateCommandOptions();
                return;
            }
            
            // æ£€æŸ¥å‘½ä»¤ç»“æ„æ˜¯å¦å­˜åœ¨
            if (!commandStructure[mainCmd] || !commandStructure[mainCmd][subCmd]) {
                subSubCmdGroup.style.display = 'none';
                updateCommandOptions();
                return;
            }

            const subSubCommands = commandStructure[mainCmd][subCmd];
            
            // ç‰¹æ®Šå¤„ç†ï¼šrca run çš„åœºæ™¯ä½œä¸ºä¸‰çº§å‘½ä»¤
            if (mainCmd === 'rca' && subCmd === 'run') {
                subSubCmdGroup.style.display = 'block';
                subSubCmdSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åœºæ™¯...</option>';
                
                // æ·»åŠ æ‰€æœ‰ RCA åœºæ™¯
                for (const [sceneKey, sceneInfo] of Object.entries(rcaScenes)) {
                    const option = document.createElement('option');
                    option.value = sceneKey;
                    option.textContent = `${sceneInfo.name} - ${sceneInfo.description}`;
                    subSubCmdSelect.appendChild(option);
                }
                
                // æ·»åŠ æ‰‹åŠ¨è¾“å…¥é€‰é¡¹
                const manualOption = document.createElement('option');
                manualOption.value = '_manual_scene';
                manualOption.textContent = 'æ‰‹åŠ¨è¾“å…¥åœºæ™¯åç§°';
                subSubCmdSelect.appendChild(manualOption);
            }
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¸‰çº§å‘½ä»¤ï¼ˆå¦‚ scene.list, scene.runï¼‰
            // å¦‚æœ subSubCommands æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸”ä¸æ˜¯ç›´æ¥çš„å‘½ä»¤é€‰é¡¹ï¼ˆæ²¡æœ‰ options å±æ€§ï¼‰ï¼Œåˆ™è¯´æ˜æœ‰ä¸‰çº§å‘½ä»¤
            else if (typeof subSubCommands === 'object' && subSubCommands !== null && !subSubCommands.options && !Array.isArray(subSubCommands)) {
                // æ£€æŸ¥æ˜¯å¦æœ‰å­å‘½ä»¤ï¼ˆlist, runç­‰ï¼‰
                // éå†æ‰€æœ‰é”®ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯¹è±¡ç±»å‹çš„å€¼ï¼ˆè¿™äº›å°±æ˜¯ä¸‰çº§å‘½ä»¤ï¼‰
                const subSubCmdKeys = Object.keys(subSubCommands).filter(key => {
                    const value = subSubCommands[key];
                    return typeof value === 'object' && value !== null && (value.options !== undefined || value.description !== undefined);
                });
                
                if (subSubCmdKeys.length > 0) {
                    // æ˜¾ç¤ºä¸‰çº§å‘½ä»¤é€‰æ‹©æ¡†
                    subSubCmdGroup.style.display = 'block';
                    subSubCmdSelect.innerHTML = '<option value="">è¯·é€‰æ‹©...</option>';
                    
                    for (const key of subSubCmdKeys) {
                        const value = subSubCommands[key];
                        const option = document.createElement('option');
                        option.value = key;
                        const desc = value.description ? `${key} - ${value.description}` : key;
                        option.textContent = desc;
                        subSubCmdSelect.appendChild(option);
                    }
                } else {
                    // æ²¡æœ‰ä¸‰çº§å‘½ä»¤ï¼Œéšè—é€‰æ‹©æ¡†
                    subSubCmdGroup.style.display = 'none';
                }
            } else {
                // ä¸æ˜¯ä¸‰çº§å‘½ä»¤ç»“æ„ï¼Œéšè—é€‰æ‹©æ¡†
                subSubCmdGroup.style.display = 'none';
            }
            
            updateSubSubSubCommands();
            updateSubCommandTooltip();
            updateSubSubCommandTooltip();
        }

        function updateSubSubSubCommands() {
            const mainCmd = document.getElementById('mainCommand').value;
            const subCmd = document.getElementById('subCommand').value;
            const subSubCmd = document.getElementById('subSubCommand').value;
            const subSubSubCmdGroup = document.getElementById('subSubSubCommandGroup');
            const subSubSubCmdSelect = document.getElementById('subSubSubCommand');
            
            subSubSubCmdSelect.innerHTML = '';
            
            // å¦‚æœæ²¡æœ‰ä¸»å‘½ä»¤ã€å­å‘½ä»¤æˆ–ä¸‰çº§å‘½ä»¤ï¼Œéšè—å››çº§å‘½ä»¤é€‰æ‹©æ¡†
            if (!mainCmd || !subCmd || !subSubCmd) {
                subSubSubCmdGroup.style.display = 'none';
                updateCommandOptions();
                return;
            }
            
            // ç‰¹æ®Šå¤„ç†ï¼šgather scene run çš„åœºæ™¯ä½œä¸ºå››çº§å‘½ä»¤
            if (mainCmd === 'gather' && subCmd === 'scene' && subSubCmd === 'run') {
                subSubSubCmdGroup.style.display = 'block';
                subSubSubCmdSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åœºæ™¯...</option>';
                
                // æ·»åŠ æ‰€æœ‰ Gather åœºæ™¯
                for (const [sceneKey, sceneInfo] of Object.entries(gatherScenes)) {
                    const option = document.createElement('option');
                    option.value = sceneKey;
                    option.textContent = `${sceneInfo.name} - ${sceneInfo.description}`;
                    subSubSubCmdSelect.appendChild(option);
                }
                
                // æ·»åŠ æ‰‹åŠ¨è¾“å…¥é€‰é¡¹
                const manualOption = document.createElement('option');
                manualOption.value = '_manual_scene';
                manualOption.textContent = 'æ‰‹åŠ¨è¾“å…¥åœºæ™¯åç§°';
                subSubSubCmdSelect.appendChild(manualOption);
            }
            // ç‰¹æ®Šå¤„ç†ï¼šdisplay scene run çš„åœºæ™¯ä½œä¸ºå››çº§å‘½ä»¤
            else if (mainCmd === 'display' && subCmd === 'scene' && subSubCmd === 'run') {
                subSubSubCmdGroup.style.display = 'block';
                subSubSubCmdSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åœºæ™¯...</option>';
                
                // æ·»åŠ æ‰€æœ‰ Display åœºæ™¯
                for (const [sceneKey, sceneInfo] of Object.entries(displayScenes)) {
                    const option = document.createElement('option');
                    option.value = sceneKey;
                    option.textContent = `${sceneInfo.name} - ${sceneInfo.description}`;
                    subSubSubCmdSelect.appendChild(option);
                }
                
                // æ·»åŠ æ‰‹åŠ¨è¾“å…¥é€‰é¡¹
                const manualOption = document.createElement('option');
                manualOption.value = '_manual_scene';
                manualOption.textContent = 'æ‰‹åŠ¨è¾“å…¥åœºæ™¯åç§°';
                subSubSubCmdSelect.appendChild(manualOption);
            }
            else {
                // æ²¡æœ‰å››çº§å‘½ä»¤ï¼Œéšè—é€‰æ‹©æ¡†
                subSubSubCmdGroup.style.display = 'none';
            }
            
            updateCommandOptions();
            updateSubSubSubCommandTooltip();
        }

        // è·å–ç¯å¢ƒå˜é‡æè¿°
        function getEnvVarDescription(envVar) {
            const envVarDescriptions = {
                'host': 'æ•°æ®åº“ä¸»æœºåœ°å€',
                'port': 'æ•°æ®åº“ç«¯å£',
                'user': 'æ•°æ®åº“ç”¨æˆ·åï¼ˆæ ¼å¼: user@tenantï¼‰',
                'password': 'æ•°æ®åº“å¯†ç ',
                'database': 'æ•°æ®åº“åç§°',
                'trace_id': 'SQL Trace ID',
                'tenant_id': 'ç§Ÿæˆ·ID',
                'tenant_name': 'ç§Ÿæˆ·åç§°',
                'database_name': 'æ•°æ®åº“åç§°',
                'table_name': 'è¡¨åç§°',
                'tablename': 'è¡¨åç§°',
                'estimated_time': 'é¢„ä¼°æ—¶é—´ï¼ˆæ ¼å¼: YYYY-MM-DD HH:MM:SSï¼‰',
                'perf_count': 'Perfé‡‡æ ·æ¬¡æ•°ï¼ˆé»˜è®¤: 100000000ï¼‰',
                'from_time': 'å¼€å§‹æ—¶é—´ï¼ˆæ ¼å¼: YYYY-MM-DD HH:MM:SSï¼‰',
                'to_time': 'ç»“æŸæ—¶é—´ï¼ˆæ ¼å¼: YYYY-MM-DD HH:MM:SSï¼‰',
                'since': 'æ—¶é—´èŒƒå›´ï¼ˆæ ¼å¼: <n><m|h|d>ï¼Œä¾‹å¦‚: 1h, 30m, 2dï¼‰',
                'svr_ip': 'æœåŠ¡å™¨IPåœ°å€',
                'svr_port': 'æœåŠ¡å™¨ç«¯å£',
                'plan_id': 'æ‰§è¡Œè®¡åˆ’ID',
                'sqlid': 'SQL ID',
                'level': 'çº§åˆ«ï¼ˆall æˆ– tenant_id æˆ– table_nameï¼‰',
                'mtime': 'æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰',
                'wait_time': 'ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰'
            };
            return envVarDescriptions[envVar] || envVar;
        }

        function updateSubSubSubCommandTooltip() {
            const mainCmd = document.getElementById('mainCommand').value;
            const subCmd = document.getElementById('subCommand').value;
            const subSubCmd = document.getElementById('subSubCommand').value;
            const subSubSubCmd = document.getElementById('subSubSubCommand').value;
            const tooltipWrapper = document.getElementById('subSubSubCommandTooltip');
            const tooltipContent = document.getElementById('subSubSubCommandTooltipContent');
            
            if (!mainCmd || !subCmd || !subSubCmd || !subSubSubCmd) {
                tooltipWrapper.style.display = 'none';
                return;
            }
            
            // ç‰¹æ®Šå¤„ç†ï¼šgather scene run + åœºæ™¯
            if (mainCmd === 'gather' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                const sceneInfo = gatherScenes[subSubSubCmd];
                if (sceneInfo) {
                    tooltipWrapper.style.display = 'inline-block';
                    let html = `<div class="tooltip-title">${sceneInfo.description}</div>`;
                    html += `<div style="margin-top: 8px;">åœºæ™¯åç§°: <strong>${sceneInfo.name}</strong></div>`;
                    
                    // æ˜¾ç¤ºå¿…éœ€çš„ç¯å¢ƒå˜é‡
                    if (sceneInfo.requiredEnv && sceneInfo.requiredEnv.length > 0) {
                        html += `<div style="margin-top: 8px;"><strong>å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š</strong></div>`;
                        sceneInfo.requiredEnv.forEach(envVar => {
                            const envVarDesc = getEnvVarDescription(envVar);
                            html += `<div class="tooltip-param"><strong>--env ${envVar}=</strong> ${envVarDesc}</div>`;
                        });
                    }
                    
                    // æ˜¾ç¤ºå¯é€‰çš„ç¯å¢ƒå˜é‡
                    if (sceneInfo.optionalEnv && sceneInfo.optionalEnv.length > 0) {
                        html += `<div style="margin-top: 8px;"><strong>å¯é€‰çš„ç¯å¢ƒå˜é‡ï¼š</strong></div>`;
                        sceneInfo.optionalEnv.forEach(envVar => {
                            const envVarDesc = getEnvVarDescription(envVar);
                            html += `<div class="tooltip-param"><strong>--env ${envVar}=</strong> ${envVarDesc}ï¼ˆå¯é€‰ï¼‰</div>`;
                        });
                    }
                    
                    html += `<div class="tooltip-example" style="margin-top: 10px;"><strong>ç¤ºä¾‹å‘½ä»¤ï¼š</strong><br>obdiag gather scene run --scene=${sceneInfo.name}</div>`;
                    tooltipContent.innerHTML = html;
                } else {
                    tooltipWrapper.style.display = 'none';
                }
                return;
            }
            // ç‰¹æ®Šå¤„ç†ï¼šdisplay scene run + åœºæ™¯
            if (mainCmd === 'display' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                const sceneInfo = displayScenes[subSubSubCmd];
                if (sceneInfo) {
                    tooltipWrapper.style.display = 'inline-block';
                    let html = `<div class="tooltip-title">${sceneInfo.description}</div>`;
                    html += `<div style="margin-top: 8px;">åœºæ™¯åç§°: <strong>${sceneInfo.name}</strong></div>`;
                    
                    // æ˜¾ç¤ºå¿…éœ€çš„ç¯å¢ƒå˜é‡
                    if (sceneInfo.requiredEnv && sceneInfo.requiredEnv.length > 0) {
                        html += `<div style="margin-top: 8px;"><strong>å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š</strong></div>`;
                        sceneInfo.requiredEnv.forEach(envVar => {
                            const envVarDesc = getEnvVarDescription(envVar);
                            html += `<div class="tooltip-param"><strong>--env ${envVar}=</strong> ${envVarDesc}</div>`;
                        });
                    }
                    
                    // æ˜¾ç¤ºå¯é€‰çš„ç¯å¢ƒå˜é‡
                    if (sceneInfo.optionalEnv && sceneInfo.optionalEnv.length > 0) {
                        html += `<div style="margin-top: 8px;"><strong>å¯é€‰çš„ç¯å¢ƒå˜é‡ï¼š</strong></div>`;
                        sceneInfo.optionalEnv.forEach(envVar => {
                            const envVarDesc = getEnvVarDescription(envVar);
                            html += `<div class="tooltip-param"><strong>--env ${envVar}=</strong> ${envVarDesc}ï¼ˆå¯é€‰ï¼‰</div>`;
                        });
                    }
                    
                    html += `<div class="tooltip-example" style="margin-top: 10px;"><strong>ç¤ºä¾‹å‘½ä»¤ï¼š</strong><br>obdiag display scene run --scene=${sceneInfo.name}</div>`;
                    tooltipContent.innerHTML = html;
                } else {
                    tooltipWrapper.style.display = 'none';
                }
                return;
            }
            
            tooltipWrapper.style.display = 'none';
        }

        function updateSubSubCommandTooltip() {
            const mainCmd = document.getElementById('mainCommand').value;
            const subCmd = document.getElementById('subCommand').value;
            const subSubCmd = document.getElementById('subSubCommand').value;
            const tooltipWrapper = document.getElementById('subSubCommandTooltip');
            const tooltipContent = document.getElementById('subSubCommandTooltipContent');
            
            if (!mainCmd || !subCmd || !subSubCmd) {
                tooltipWrapper.style.display = 'none';
                return;
            }
            
            // ç‰¹æ®Šå¤„ç†ï¼šrca run + åœºæ™¯
            if (mainCmd === 'rca' && subCmd === 'run' && subSubCmd && subSubCmd !== '_manual_scene') {
                const sceneInfo = rcaScenes[subSubCmd];
                if (sceneInfo) {
                    tooltipWrapper.style.display = 'inline-block';
                    let html = `<div class="tooltip-title">${sceneInfo.description}</div>`;
                    html += `<div style="margin-top: 8px;">åœºæ™¯åç§°: <strong>${sceneInfo.name}</strong></div>`;
                    html += `<div class="tooltip-example" style="margin-top: 10px;"><strong>ç¤ºä¾‹å‘½ä»¤ï¼š</strong><br>obdiag rca run --scene=${sceneInfo.name}</div>`;
                    tooltipContent.innerHTML = html;
                } else {
                    tooltipWrapper.style.display = 'none';
                }
                return;
            }
            
            const cmdStruct = commandStructure[mainCmd];
            if (!cmdStruct || !cmdStruct[subCmd] || !cmdStruct[subCmd][subSubCmd]) {
                tooltipWrapper.style.display = 'none';
                return;
            }
            
            const cmdInfo = cmdStruct[subCmd][subSubCmd];
            const helpKey = `${mainCmd}.${subCmd}.${subSubCmd}`;
            const help = commandHelp[helpKey];
            
            if (cmdInfo.description || help) {
                tooltipWrapper.style.display = 'inline-block';
                let html = `<div class="tooltip-title">${cmdInfo.description || help?.description || subSubCmd}</div>`;
                
                if (help && help.params) {
                    html += '<div style="margin-top: 8px;"><strong>å‚æ•°è¯´æ˜ï¼š</strong></div>';
                    for (const [param, desc] of Object.entries(help.params)) {
                        html += `<div class="tooltip-param"><strong>${param}</strong>: ${desc}</div>`;
                    }
                }
                
                if (help && help.example) {
                    html += `<div class="tooltip-example" style="margin-top: 10px;"><strong>ç¤ºä¾‹ï¼š</strong><br>${help.example}</div>`;
                } else if (cmdInfo.options && cmdInfo.options.length > 0) {
                    html += `<div style="margin-top: 8px;"><strong>å¯ç”¨å‚æ•°ï¼š</strong> ${cmdInfo.options.join(', ')}</div>`;
                }
                
                tooltipContent.innerHTML = html;
            } else {
                tooltipWrapper.style.display = 'none';
            }
        }

        function updateCommandOptions() {
            const mainCmd = document.getElementById('mainCommand').value;
            const subCmd = document.getElementById('subCommand').value;
            const subSubCmd = document.getElementById('subSubCommand').value;
            const subSubSubCmd = document.getElementById('subSubSubCommand').value;
            const optionsDiv = document.getElementById('commandOptions');
            
            optionsDiv.innerHTML = '';
            
            if (!mainCmd) {
                return;
            }

            let options = [];
            const cmdStruct = commandStructure[mainCmd];
            
            // ç‰¹æ®Šå¤„ç†ï¼šrca run + åœºæ™¯
            if (mainCmd === 'rca' && subCmd === 'run' && subSubCmd && subSubCmd !== '_manual_scene') {
                // ä½¿ç”¨åœºæ™¯å¯¹åº”çš„é€‰é¡¹
                if (cmdStruct && cmdStruct[subCmd] && cmdStruct[subCmd][subSubCmd] && cmdStruct[subCmd][subSubCmd].options) {
                    options = cmdStruct[subCmd][subSubCmd].options;
                }
            } else if (subSubCmd && subCmd && cmdStruct && cmdStruct[subCmd] && cmdStruct[subCmd][subSubCmd]) {
                // ä¸‰çº§å‘½ä»¤ï¼Œå¦‚ gather scene list
                if (cmdStruct[subCmd][subSubCmd].options) {
                    options = cmdStruct[subCmd][subSubCmd].options;
                }
            } else if (subCmd && cmdStruct && cmdStruct[subCmd]) {
                // äºŒçº§å‘½ä»¤
                if (cmdStruct[subCmd].options) {
                    options = cmdStruct[subCmd].options;
                }
            } else if (cmdStruct && cmdStruct.options) {
                // ä¸€çº§å‘½ä»¤
                options = cmdStruct.options;
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰åœºæ™¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
            let sceneRequiredEnv = [];
            let sceneOptionalEnv = [];
            if (mainCmd === 'gather' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                const sceneInfo = gatherScenes[subSubSubCmd];
                if (sceneInfo) {
                    sceneRequiredEnv = sceneInfo.requiredEnv || [];
                    sceneOptionalEnv = sceneInfo.optionalEnv || [];
                }
            } else if (mainCmd === 'display' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                const sceneInfo = displayScenes[subSubSubCmd];
                if (sceneInfo) {
                    sceneRequiredEnv = sceneInfo.requiredEnv || [];
                    sceneOptionalEnv = sceneInfo.optionalEnv || [];
                }
            }

            if (options.length === 0 && sceneRequiredEnv.length === 0 && sceneOptionalEnv.length === 0) {
                optionsDiv.innerHTML = '<p style="color: #6c757d;">æ­¤å‘½ä»¤æ— éœ€é¢å¤–å‚æ•°</p>';
            } else {
            // ç‰¹æ®Šå¤„ç†ï¼šrca run + æ‰‹åŠ¨è¾“å…¥åœºæ™¯æ—¶ï¼Œscene å‚æ•°æ˜¯å¿…å¡«çš„
            const isManualScene = (mainCmd === 'rca' && subCmd === 'run' && subSubCmd === '_manual_scene');
            
            // å¦‚æœåœºæ™¯æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼Œå…ˆæ˜¾ç¤ºå®ƒä»¬
            if (sceneRequiredEnv.length > 0 || sceneOptionalEnv.length > 0) {
                const sceneEnvSection = document.createElement('div');
                sceneEnvSection.style.marginBottom = '20px';
                sceneEnvSection.style.padding = '15px';
                sceneEnvSection.style.background = '#fff3cd';
                sceneEnvSection.style.border = '1px solid #ffc107';
                sceneEnvSection.style.borderRadius = '6px';
                
                const sceneEnvTitle = document.createElement('div');
                sceneEnvTitle.style.fontWeight = 'bold';
                sceneEnvTitle.style.marginBottom = '10px';
                sceneEnvTitle.style.color = '#856404';
                sceneEnvTitle.textContent = 'ğŸ“‹ åœºæ™¯å¿…éœ€çš„ç¯å¢ƒå˜é‡';
                sceneEnvSection.appendChild(sceneEnvTitle);
                
                // æ˜¾ç¤ºå¿…éœ€çš„ç¯å¢ƒå˜é‡
                if (sceneRequiredEnv.length > 0) {
                    sceneRequiredEnv.forEach(envVar => {
                        const envGroup = document.createElement('div');
                        envGroup.className = 'form-group';
                        envGroup.style.marginBottom = '10px';
                        
                        const envLabel = document.createElement('label');
                        envLabel.style.fontSize = '14px';
                        envLabel.style.fontWeight = '500';
                        const envVarDesc = getEnvVarDescription(envVar);
                        envLabel.innerHTML = `--env ${envVar}= <span style="color: red;">*</span> <span style="color: #6c757d; font-weight: normal;">(${envVarDesc})</span>`;
                        envGroup.appendChild(envLabel);
                        
                        const envInput = document.createElement('input');
                        envInput.type = envVar === 'password' ? 'password' : 'text';
                        envInput.className = `scene-env-input scene-env-${envVar}`;
                        envInput.dataset.envVar = envVar;
                        envInput.placeholder = `è¯·è¾“å…¥ ${envVar}`;
                        envInput.style.marginTop = '5px';
                        envInput.oninput = updateCommandOutput;
                        envGroup.appendChild(envInput);
                        
                        sceneEnvSection.appendChild(envGroup);
                    });
                }
                
                // æ˜¾ç¤ºå¯é€‰çš„ç¯å¢ƒå˜é‡
                if (sceneOptionalEnv.length > 0) {
                    const optionalTitle = document.createElement('div');
                    optionalTitle.style.fontWeight = 'bold';
                    optionalTitle.style.marginTop = '15px';
                    optionalTitle.style.marginBottom = '10px';
                    optionalTitle.style.color = '#856404';
                    optionalTitle.textContent = 'ğŸ“‹ åœºæ™¯å¯é€‰çš„ç¯å¢ƒå˜é‡';
                    sceneEnvSection.appendChild(optionalTitle);
                    
                    sceneOptionalEnv.forEach(envVar => {
                        const envGroup = document.createElement('div');
                        envGroup.className = 'form-group';
                        envGroup.style.marginBottom = '10px';
                        
                        const envLabel = document.createElement('label');
                        envLabel.style.fontSize = '14px';
                        envLabel.style.fontWeight = '500';
                        const envVarDesc = getEnvVarDescription(envVar);
                        envLabel.innerHTML = `--env ${envVar}= <span style="color: #6c757d; font-weight: normal;">(${envVarDesc}ï¼Œå¯é€‰)</span>`;
                        envGroup.appendChild(envLabel);
                        
                        const envInput = document.createElement('input');
                        envInput.type = envVar === 'password' ? 'password' : 'text';
                        envInput.className = `scene-env-input scene-env-${envVar}`;
                        envInput.dataset.envVar = envVar;
                        envInput.placeholder = `è¯·è¾“å…¥ ${envVar}ï¼ˆå¯é€‰ï¼‰`;
                        envInput.style.marginTop = '5px';
                        envInput.oninput = updateCommandOutput;
                        envGroup.appendChild(envInput);
                        
                        sceneEnvSection.appendChild(envGroup);
                    });
                }
                
                optionsDiv.appendChild(sceneEnvSection);
            }
            
            options.forEach(opt => {
                const desc = optionDescriptions[opt] || { label: opt, placeholder: '', type: 'text' };
                const formGroup = document.createElement('div');
                formGroup.className = 'form-group';
                
                const label = document.createElement('label');
                // æ£€æŸ¥æ˜¯å¦ä¸ºå¿…å¡«å‚æ•°ï¼ˆå¤ç”¨ä¸Šé¢çš„cmdStructå˜é‡ï¼‰
                let isRequired = false;
                if (subSubCmd && subCmd && cmdStruct && cmdStruct[subCmd] && cmdStruct[subCmd][subSubCmd] && cmdStruct[subCmd][subSubCmd].required) {
                    isRequired = cmdStruct[subCmd][subSubCmd].required.includes(opt);
                } else if (subCmd && cmdStruct && cmdStruct[subCmd] && cmdStruct[subCmd].required) {
                    isRequired = cmdStruct[subCmd].required.includes(opt);
                } else if (cmdStruct && cmdStruct.required) {
                    isRequired = cmdStruct.required.includes(opt);
                }
                // ç‰¹æ®Šå¤„ç†ï¼šæ‰‹åŠ¨è¾“å…¥åœºæ™¯æ—¶ï¼Œscene å‚æ•°å¿…å¡«
                if (isManualScene && opt === 'scene') {
                    isRequired = true;
                }
                if (desc.required) {
                    isRequired = true;
                }
                
                // ç‰¹æ®Šå¤„ç†ï¼šå¦‚æœå·²ç»é€‰æ‹©äº†åœºæ™¯ï¼Œéšè— scene è¾“å…¥æ¡†æˆ–æ˜¾ç¤ºä¸ºåªè¯»
                if (opt === 'scene' && mainCmd === 'rca' && subCmd === 'run' && subSubCmd && subSubCmd !== '_manual_scene') {
                    // å·²é€‰æ‹©åœºæ™¯ï¼Œä¸æ˜¾ç¤º scene è¾“å…¥æ¡†
                    return;
                }
                // ç‰¹æ®Šå¤„ç†ï¼šgather scene run + åœºæ™¯ï¼ˆå››çº§å‘½ä»¤ï¼‰
                if (opt === 'scene' && mainCmd === 'gather' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                    // å·²é€‰æ‹©åœºæ™¯ï¼Œä¸æ˜¾ç¤º scene è¾“å…¥æ¡†
                    return;
                }
                // ç‰¹æ®Šå¤„ç†ï¼šdisplay scene run + åœºæ™¯ï¼ˆå››çº§å‘½ä»¤ï¼‰
                if (opt === 'scene' && mainCmd === 'display' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                    // å·²é€‰æ‹©åœºæ™¯ï¼Œä¸æ˜¾ç¤º scene è¾“å…¥æ¡†
                    return;
                }
                    
                    label.innerHTML = (desc.label || opt) + (isRequired ? ' <span style="color: red;">*</span>' : '');
                    
                    // æ·»åŠ å¸®åŠ©æç¤ºå›¾æ ‡
                    if (desc.help) {
                        const tooltipWrapper = document.createElement('span');
                        tooltipWrapper.className = 'tooltip-wrapper';
                        const tooltipIcon = document.createElement('span');
                        tooltipIcon.className = 'tooltip-icon';
                        tooltipIcon.textContent = '?';
                        const tooltipContent = document.createElement('div');
                        tooltipContent.className = 'tooltip-content';
                        tooltipContent.innerHTML = `<div class="tooltip-title">å‚æ•°è¯´æ˜</div><div>${desc.help}</div>`;
                        
                        // åŠ¨æ€å®šä½tooltipï¼Œé¿å…é®æŒ¡
                        let tooltipTimeout;
                        tooltipWrapper.addEventListener('mouseenter', function(e) {
                            clearTimeout(tooltipTimeout);
                            // å»¶è¿Ÿæ˜¾ç¤ºï¼Œé¿å…å¿«é€Ÿç§»åŠ¨æ—¶é—ªçƒ
                            tooltipTimeout = setTimeout(function() {
                                const rect = tooltipIcon.getBoundingClientRect();
                                const viewportWidth = window.innerWidth;
                                const viewportHeight = window.innerHeight;
                                
                                // å…ˆæ˜¾ç¤ºä»¥è·å–tooltipçš„å®é™…å°ºå¯¸
                                tooltipContent.style.visibility = 'visible';
                                tooltipContent.style.opacity = '0';
                                const tooltipRect = tooltipContent.getBoundingClientRect();
                                
                                let top = rect.top - tooltipRect.height - 10;
                                let left = rect.left + rect.width / 2;
                                
                                // å¦‚æœä¸Šæ–¹ç©ºé—´ä¸è¶³ï¼Œæ˜¾ç¤ºåœ¨ä¸‹æ–¹
                                if (top < 10) {
                                    top = rect.bottom + 10;
                                }
                                
                                // å¦‚æœä¸‹æ–¹ç©ºé—´ä¹Ÿä¸è¶³ï¼Œæ˜¾ç¤ºåœ¨å³ä¾§
                                if (top + tooltipRect.height > viewportHeight - 10) {
                                    top = Math.max(10, viewportHeight - tooltipRect.height - 10);
                                    left = rect.right + 15;
                                }
                                
                                // è°ƒæ•´æ°´å¹³ä½ç½®ï¼Œé¿å…è¶…å‡ºè§†å£
                                if (left + tooltipRect.width / 2 > viewportWidth - 10) {
                                    left = viewportWidth - tooltipRect.width / 2 - 10;
                                }
                                if (left - tooltipRect.width / 2 < 10) {
                                    left = tooltipRect.width / 2 + 10;
                                }
                                
                                tooltipContent.style.top = top + 'px';
                                tooltipContent.style.left = left + 'px';
                                tooltipContent.style.transform = 'translateX(-50%)';
                                tooltipContent.style.opacity = '1';
                            }, 100);
                        });
                        
                        tooltipWrapper.addEventListener('mouseleave', function() {
                            clearTimeout(tooltipTimeout);
                            tooltipContent.style.visibility = 'hidden';
                            tooltipContent.style.opacity = '0';
                        });
                        
                        tooltipWrapper.appendChild(tooltipIcon);
                        tooltipWrapper.appendChild(tooltipContent);
                        label.appendChild(tooltipWrapper);
                    }
                    
                    formGroup.appendChild(label);
                    
                    if (isRequired) {
                        formGroup.style.borderLeft = '4px solid #dc3545';
                    }
                    
                    if (desc.type === 'checkbox') {
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.id = `opt_${opt}`;
                        checkbox.name = opt;
                        formGroup.appendChild(checkbox);
                    } else if (desc.type === 'db_env') {
                        // æ•°æ®åº“è¿æ¥ç¯å¢ƒå˜é‡è¾“å…¥æ¡†
                        const dbEnvDiv = document.createElement('div');
                        dbEnvDiv.className = 'db-env-container';
                        dbEnvDiv.id = `opt_${opt}_container`;
                        
                        const dbFields = [
                            { key: 'host', label: 'ä¸»æœº (host)', placeholder: 'ä¾‹å¦‚: 127.0.0.1', required: true },
                            { key: 'port', label: 'ç«¯å£ (port)', placeholder: 'ä¾‹å¦‚: 2881', required: true },
                            { key: 'user', label: 'ç”¨æˆ· (user)', placeholder: 'ä¾‹å¦‚: test@test', required: true },
                            { key: 'password', label: 'å¯†ç  (password)', placeholder: 'è¾“å…¥å¯†ç ', required: true, type: 'password' },
                            { key: 'database', label: 'æ•°æ®åº“ (database)', placeholder: 'ä¾‹å¦‚: test', required: true }
                        ];
                        
                        dbFields.forEach(field => {
                            const fieldGroup = document.createElement('div');
                            fieldGroup.className = 'form-group';
                            fieldGroup.style.marginBottom = '10px';
                            
                            const fieldLabel = document.createElement('label');
                            fieldLabel.innerHTML = field.label + (field.required ? ' <span style="color: red;">*</span>' : '');
                            fieldLabel.style.fontSize = '14px';
                            fieldGroup.appendChild(fieldLabel);
                            
                            const fieldInput = document.createElement('input');
                            fieldInput.type = field.type || 'text';
                            fieldInput.className = `db-env-input db-env-${field.key}`;
                            fieldInput.dataset.key = field.key;
                            fieldInput.placeholder = field.placeholder;
                            fieldInput.required = field.required;
                            fieldInput.oninput = updateCommandOutput;
                            fieldGroup.appendChild(fieldInput);
                            
                            dbEnvDiv.appendChild(fieldGroup);
                        });
                        
                        formGroup.appendChild(dbEnvDiv);
                    } else if (desc.type === 'multi' && desc.multiple) {
                        // æ”¯æŒå¤šä¸ªè¾“å…¥çš„ç±»å‹ï¼ˆå¦‚ --env, --grep, --filesï¼‰
                        const listDiv = document.createElement('div');
                        listDiv.className = 'node-list';
                        listDiv.id = `opt_${opt}_list`;
                        
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'node-item';
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.className = `multi-input-${opt}`;
                        input.placeholder = desc.placeholder || '';
                        input.oninput = updateCommandOutput;
                        const removeBtn = document.createElement('button');
                        removeBtn.type = 'button';
                        removeBtn.className = 'btn remove-node-btn';
                        removeBtn.textContent = 'åˆ é™¤';
                        removeBtn.onclick = function() { removeMultiInput(this, opt); };
                        
                        itemDiv.appendChild(input);
                        itemDiv.appendChild(removeBtn);
                        listDiv.appendChild(itemDiv);
                        
                        const addBtn = document.createElement('button');
                        addBtn.type = 'button';
                        addBtn.className = 'btn add-node-btn';
                        addBtn.textContent = 'æ·»åŠ ';
                        addBtn.onclick = function() { addMultiInput(opt, desc.placeholder || ''); };
                        
                        formGroup.appendChild(listDiv);
                        formGroup.appendChild(addBtn);
                    } else if (desc.type === 'select') {
                        // ä¸‹æ‹‰é€‰æ‹©æ¡†ç±»å‹
                        // æ ¹æ®å‘½ä»¤ç±»å‹åŠ¨æ€é€‰æ‹©åœºæ™¯åˆ—è¡¨
                        let sceneOptions = null;
                        if (opt === 'scene') {
                            if (mainCmd === 'gather' && subCmd === 'scene') {
                                sceneOptions = gatherScenes;
                            } else if (mainCmd === 'display' && subCmd === 'scene') {
                                sceneOptions = displayScenes;
                            }
                        } else if (desc.options) {
                            sceneOptions = desc.options;
                        }
                        
                        if (sceneOptions) {
                            const select = document.createElement('select');
                            select.id = `opt_${opt}`;
                            select.name = opt;
                            select.onchange = updateCommandOutput;
                            
                            // æ·»åŠ ç©ºé€‰é¡¹
                            const emptyOption = document.createElement('option');
                            emptyOption.value = '';
                            emptyOption.textContent = desc.placeholder || 'è¯·é€‰æ‹©...';
                            select.appendChild(emptyOption);
                            
                            // æ·»åŠ æ‰€æœ‰é€‰é¡¹
                            for (const [key, sceneInfo] of Object.entries(sceneOptions)) {
                                const option = document.createElement('option');
                                option.value = sceneInfo.name;
                                option.textContent = `${sceneInfo.name} - ${sceneInfo.description}`;
                                select.appendChild(option);
                            }
                            
                            // æ·»åŠ æ‰‹åŠ¨è¾“å…¥é€‰é¡¹
                            const manualOption = document.createElement('option');
                            manualOption.value = '__manual__';
                            manualOption.textContent = 'æ‰‹åŠ¨è¾“å…¥...';
                            select.appendChild(manualOption);
                            
                            formGroup.appendChild(select);
                            
                            // æ·»åŠ æ‰‹åŠ¨è¾“å…¥æ¡†ï¼ˆé»˜è®¤éšè—ï¼‰
                            const manualInput = document.createElement('input');
                            manualInput.type = 'text';
                            manualInput.id = `opt_${opt}_manual`;
                            manualInput.name = `${opt}_manual`;
                            manualInput.placeholder = 'æ‰‹åŠ¨è¾“å…¥åœºæ™¯åç§°';
                            manualInput.style.display = 'none';
                            manualInput.style.marginTop = '10px';
                            manualInput.oninput = updateCommandOutput;
                            formGroup.appendChild(manualInput);
                            
                            // ç›‘å¬é€‰æ‹©å˜åŒ–ï¼Œæ˜¾ç¤º/éšè—æ‰‹åŠ¨è¾“å…¥æ¡†
                            select.addEventListener('change', function() {
                                if (this.value === '__manual__') {
                                    manualInput.style.display = 'block';
                                    manualInput.focus();
                                } else {
                                    manualInput.style.display = 'none';
                                    manualInput.value = '';
                                }
                                updateCommandOutput();
                            });
                        } else {
                            // å¦‚æœæ²¡æœ‰åœºæ™¯åˆ—è¡¨ï¼Œä½¿ç”¨æ™®é€šæ–‡æœ¬è¾“å…¥æ¡†
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.id = `opt_${opt}`;
                            input.name = opt;
                            input.placeholder = desc.placeholder || '';
                            input.oninput = updateCommandOutput;
                            formGroup.appendChild(input);
                        }
                    } else {
                        const input = document.createElement('input');
                        input.type = desc.type || 'text';
                        input.id = `opt_${opt}`;
                        input.name = opt;
                        input.placeholder = desc.placeholder || '';
                        input.oninput = updateCommandOutput;
                        formGroup.appendChild(input);
                    }
                    
                    optionsDiv.appendChild(formGroup);
                });
            }
            
            updateCommandOutput();
        }

        function addObserverNode() {
            const nodesDiv = document.getElementById('observerNodes');
            const nodeItem = document.createElement('div');
            nodeItem.className = 'node-item';
            nodeItem.innerHTML = `
                <input type="text" class="node-ip" placeholder="èŠ‚ç‚¹ IP åœ°å€" oninput="updateCommandOutput()">
                <input type="text" class="node-data-dir" placeholder="data_dir (å¯é€‰)" oninput="updateCommandOutput()">
                <input type="text" class="node-redo-dir" placeholder="redo_dir (å¯é€‰)" oninput="updateCommandOutput()">
                <button type="button" class="btn remove-node-btn" onclick="removeObserverNode(this)">åˆ é™¤</button>
            `;
            nodesDiv.appendChild(nodeItem);
            updateCommandOutput();
        }

        function removeObserverNode(btn) {
            btn.parentElement.remove();
            updateCommandOutput();
        }

        function addObproxyNode() {
            const nodesDiv = document.getElementById('obproxyNodes');
            const nodeItem = document.createElement('div');
            nodeItem.className = 'node-item';
            nodeItem.innerHTML = `
                <input type="text" class="proxy-node-ip" placeholder="èŠ‚ç‚¹ IP åœ°å€" oninput="updateCommandOutput()">
                <button type="button" class="btn remove-node-btn" onclick="removeObproxyNode(this)">åˆ é™¤</button>
            `;
            nodesDiv.appendChild(nodeItem);
            updateCommandOutput();
        }

        function removeObproxyNode(btn) {
            btn.parentElement.remove();
            updateCommandOutput();
        }

        function addMultiInput(opt, placeholder) {
            const listDiv = document.getElementById(`opt_${opt}_list`);
            if (!listDiv) return;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'node-item';
            const input = document.createElement('input');
            input.type = 'text';
            input.className = `multi-input-${opt}`;
            input.placeholder = placeholder;
            input.oninput = updateCommandOutput;
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'btn remove-node-btn';
            removeBtn.textContent = 'åˆ é™¤';
            removeBtn.onclick = function() { removeMultiInput(this, opt); };
            
            itemDiv.appendChild(input);
            itemDiv.appendChild(removeBtn);
            listDiv.appendChild(itemDiv);
            updateCommandOutput();
        }

        function removeMultiInput(btn, opt) {
            btn.parentElement.remove();
            updateCommandOutput();
        }

        function updateCommandOutput() {
            const mainCmd = document.getElementById('mainCommand').value;
            if (!mainCmd) {
                document.getElementById('commandOutput').textContent = 'è¯·é€‰æ‹©åŠŸèƒ½å¹¶å¡«å†™é…ç½®...';
                return;
            }

            let command = 'obdiag';
            const parts = [];

            // æ·»åŠ ä¸»å‘½ä»¤
            parts.push(mainCmd);

            // æ·»åŠ å­å‘½ä»¤
            const subCmd = document.getElementById('subCommand').value;
            if (subCmd) {
                parts.push(subCmd);
            }

            // æ·»åŠ ä¸‰çº§å‘½ä»¤
            const subSubCmd = document.getElementById('subSubCommand').value;
            if (subSubCmd) {
                // ç‰¹æ®Šå¤„ç†ï¼šrca run + åœºæ™¯ï¼Œåœºæ™¯ä½œä¸º --scene å‚æ•°ï¼Œä¸æ˜¯ä½ç½®å‚æ•°
                if (mainCmd === 'rca' && subCmd === 'run' && subSubCmd !== '_manual_scene') {
                    // åœºæ™¯ä¼šåœ¨å‚æ•°éƒ¨åˆ†æ·»åŠ ä¸º --scene
                } else {
                    parts.push(subSubCmd);
                }
            }

            // æ·»åŠ å››çº§å‘½ä»¤ï¼ˆåœºæ™¯é€‰æ‹©ï¼‰
            const subSubSubCmd = document.getElementById('subSubSubCommand').value;
            if (subSubSubCmd) {
                // ç‰¹æ®Šå¤„ç†ï¼šgather scene run + åœºæ™¯ï¼Œåœºæ™¯ä½œä¸º --scene å‚æ•°ï¼Œä¸æ˜¯ä½ç½®å‚æ•°
                if (mainCmd === 'gather' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd !== '_manual_scene') {
                    // åœºæ™¯ä¼šåœ¨å‚æ•°éƒ¨åˆ†æ·»åŠ ä¸º --scene
                }
                // ç‰¹æ®Šå¤„ç†ï¼šdisplay scene run + åœºæ™¯ï¼Œåœºæ™¯ä½œä¸º --scene å‚æ•°ï¼Œä¸æ˜¯ä½ç½®å‚æ•°
                else if (mainCmd === 'display' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd !== '_manual_scene') {
                    // åœºæ™¯ä¼šåœ¨å‚æ•°éƒ¨åˆ†æ·»åŠ ä¸º --scene
                }
            }

            // æ·»åŠ é…ç½®å‚æ•°
            const configs = [];

            // æ•°æ®åº“é…ç½®
            const dbHost = document.getElementById('dbHost').value;
            const dbPort = document.getElementById('dbPort').value;
            const dbUser = document.getElementById('dbUser').value;
            const dbPassword = document.getElementById('dbPassword').value;

            if (dbHost) configs.push(`db_host=${dbHost}`);
            if (dbPort) configs.push(`db_port=${dbPort}`);
            if (dbUser) configs.push(`tenant_sys.user=${dbUser}`);
            if (dbPassword) configs.push(`tenant_sys.password=${dbPassword}`);

            // Observeré…ç½®
            const observerSshUsername = document.getElementById('observerSshUsername').value;
            const observerSshPassword = document.getElementById('observerSshPassword').value;
            const observerSshKeyFile = document.getElementById('observerSshKeyFile').value;
            const observerSshPort = document.getElementById('observerSshPort').value;
            const observerHomePath = document.getElementById('observerHomePath').value;

            if (observerSshUsername) configs.push(`obcluster.servers.global.ssh_username=${observerSshUsername}`);
            if (observerSshPassword) configs.push(`obcluster.servers.global.ssh_password=${observerSshPassword}`);
            if (observerSshKeyFile) configs.push(`obcluster.servers.global.ssh_key_file=${observerSshKeyFile}`);
            if (observerSshPort && observerSshPort !== '22') configs.push(`obcluster.servers.global.ssh_port=${observerSshPort}`);
            if (observerHomePath) configs.push(`obcluster.servers.global.home_path=${observerHomePath}`);

            // ObserverèŠ‚ç‚¹
            const observerNodes = document.querySelectorAll('#observerNodes .node-ip');
            observerNodes.forEach((node, index) => {
                const ip = node.value;
                if (ip) {
                    configs.push(`obcluster.servers.nodes[${index}].ip=${ip}`);
                    
                    const dataDir = node.parentElement.querySelector('.node-data-dir').value;
                    const redoDir = node.parentElement.querySelector('.node-redo-dir').value;
                    if (dataDir) configs.push(`obcluster.servers.nodes[${index}].data_dir=${dataDir}`);
                    if (redoDir) configs.push(`obcluster.servers.nodes[${index}].redo_dir=${redoDir}`);
                }
            });

            // OBProxyé…ç½®
            const obproxySshUsername = document.getElementById('obproxySshUsername').value;
            const obproxySshPassword = document.getElementById('obproxySshPassword').value;
            const obproxySshKeyFile = document.getElementById('obproxySshKeyFile').value;
            const obproxyHomePath = document.getElementById('obproxyHomePath').value;

            if (obproxySshUsername) configs.push(`obproxy.servers.global.ssh_username=${obproxySshUsername}`);
            if (obproxySshPassword) configs.push(`obproxy.servers.global.ssh_password=${obproxySshPassword}`);
            if (obproxySshKeyFile) configs.push(`obproxy.servers.global.ssh_key_file=${obproxySshKeyFile}`);
            if (obproxyHomePath) configs.push(`obproxy.servers.global.home_path=${obproxyHomePath}`);

            // OBProxyèŠ‚ç‚¹
            const obproxyNodes = document.querySelectorAll('#obproxyNodes .proxy-node-ip');
            obproxyNodes.forEach((node, index) => {
                const ip = node.value;
                if (ip) {
                    configs.push(`obproxy.servers.nodes[${index}].ip=${ip}`);
                }
            });

            // æ·»åŠ åœºæ™¯å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼ˆåœ¨æ·»åŠ å‘½ä»¤å‚æ•°ä¹‹å‰ï¼‰
            if (mainCmd === 'gather' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                const sceneInfo = gatherScenes[subSubSubCmd];
                if (sceneInfo) {
                    // æ”¶é›†åœºæ™¯å¿…éœ€å’Œå¯é€‰çš„ç¯å¢ƒå˜é‡
                    const allSceneEnv = [...(sceneInfo.requiredEnv || []), ...(sceneInfo.optionalEnv || [])];
                    allSceneEnv.forEach(envVar => {
                        const envInput = document.querySelector(`.scene-env-${envVar}`);
                        if (envInput && envInput.value.trim()) {
                            parts.push(`--env ${envVar}=${envInput.value.trim()}`);
                        }
                    });
                }
            } else if (mainCmd === 'display' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                const sceneInfo = displayScenes[subSubSubCmd];
                if (sceneInfo) {
                    // æ”¶é›†åœºæ™¯å¿…éœ€å’Œå¯é€‰çš„ç¯å¢ƒå˜é‡
                    const allSceneEnv = [...(sceneInfo.requiredEnv || []), ...(sceneInfo.optionalEnv || [])];
                    allSceneEnv.forEach(envVar => {
                        const envInput = document.querySelector(`.scene-env-${envVar}`);
                        if (envInput && envInput.value.trim()) {
                            parts.push(`--env ${envVar}=${envInput.value.trim()}`);
                        }
                    });
                }
            }

            // æ·»åŠ å‘½ä»¤å‚æ•°
            const cmdStructForOptions = commandStructure[mainCmd];
            let options = [];
            
            // ç‰¹æ®Šå¤„ç†ï¼šrca run + åœºæ™¯
            if (mainCmd === 'rca' && subCmd === 'run' && subSubCmd && subSubCmd !== '_manual_scene') {
                // ä½¿ç”¨åœºæ™¯å¯¹åº”çš„é€‰é¡¹ï¼Œå¹¶è‡ªåŠ¨æ·»åŠ  --scene å‚æ•°
                if (cmdStructForOptions && cmdStructForOptions[subCmd] && cmdStructForOptions[subCmd][subSubCmd] && cmdStructForOptions[subCmd][subSubCmd].options) {
                    options = cmdStructForOptions[subCmd][subSubCmd].options;
                    // è‡ªåŠ¨æ·»åŠ åœºæ™¯å‚æ•°
                    parts.push(`--scene ${subSubCmd}`);
                }
            }
            // ç‰¹æ®Šå¤„ç†ï¼šgather scene run + åœºæ™¯ï¼ˆå››çº§å‘½ä»¤ï¼‰
            else if (mainCmd === 'gather' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                // ä½¿ç”¨åœºæ™¯å¯¹åº”çš„é€‰é¡¹ï¼Œå¹¶è‡ªåŠ¨æ·»åŠ  --scene å‚æ•°
                if (cmdStructForOptions && cmdStructForOptions[subCmd] && cmdStructForOptions[subCmd][subSubCmd] && cmdStructForOptions[subCmd][subSubCmd].options) {
                    options = cmdStructForOptions[subCmd][subSubCmd].options;
                    // è‡ªåŠ¨æ·»åŠ åœºæ™¯å‚æ•°
                    parts.push(`--scene ${subSubSubCmd}`);
                }
            }
            // ç‰¹æ®Šå¤„ç†ï¼šdisplay scene run + åœºæ™¯ï¼ˆå››çº§å‘½ä»¤ï¼‰
            else if (mainCmd === 'display' && subCmd === 'scene' && subSubCmd === 'run' && subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                // ä½¿ç”¨åœºæ™¯å¯¹åº”çš„é€‰é¡¹ï¼Œå¹¶è‡ªåŠ¨æ·»åŠ  --scene å‚æ•°
                if (cmdStructForOptions && cmdStructForOptions[subCmd] && cmdStructForOptions[subCmd][subSubCmd] && cmdStructForOptions[subCmd][subSubCmd].options) {
                    options = cmdStructForOptions[subCmd][subSubCmd].options;
                    // è‡ªåŠ¨æ·»åŠ åœºæ™¯å‚æ•°
                    parts.push(`--scene ${subSubSubCmd}`);
                }
            }
            else if (subSubCmd && subCmd && cmdStructForOptions && cmdStructForOptions[subCmd] && cmdStructForOptions[subCmd][subSubCmd]) {
                // ä¸‰çº§å‘½ä»¤
                if (cmdStructForOptions[subCmd][subSubCmd].options) {
                    options = cmdStructForOptions[subCmd][subSubCmd].options;
                }
            } else if (subCmd && cmdStructForOptions && cmdStructForOptions[subCmd]) {
                // äºŒçº§å‘½ä»¤
                if (cmdStructForOptions[subCmd].options) {
                    options = cmdStructForOptions[subCmd].options;
                }
            } else if (cmdStructForOptions && cmdStructForOptions.options) {
                // ä¸€çº§å‘½ä»¤
                options = cmdStructForOptions.options;
            }

            options.forEach(opt => {
                const desc = optionDescriptions[opt] || {};
                
                // å¤„ç†æ•°æ®åº“è¿æ¥ç¯å¢ƒå˜é‡
                if (desc.type === 'db_env') {
                    const container = document.getElementById(`opt_${opt}_container`);
                    if (container) {
                        const host = container.querySelector('.db-env-host')?.value.trim();
                        const port = container.querySelector('.db-env-port')?.value.trim();
                        const user = container.querySelector('.db-env-user')?.value.trim();
                        const password = container.querySelector('.db-env-password')?.value.trim();
                        const database = container.querySelector('.db-env-database')?.value.trim();
                        
                        if (host) parts.push(`--env host=${host}`);
                        if (port) parts.push(`--env port=${port}`);
                        if (user) parts.push(`--env user=${user}`);
                        if (password) parts.push(`--env password=${password}`);
                        if (database) parts.push(`--env database=${database}`);
                    }
                } else if (desc.type === 'multi' && desc.multiple) {
                    // å¤„ç†æ”¯æŒå¤šä¸ªè¾“å…¥çš„ç±»å‹ï¼ˆ--env, --grep, --filesï¼‰
                    const inputs = document.querySelectorAll(`.multi-input-${opt}`);
                    inputs.forEach(input => {
                        const value = input.value.trim();
                        if (value) {
                            parts.push(`--${opt} ${value}`);
                        }
                    });
                } else if (desc.type === 'select') {
                    // å¤„ç†ä¸‹æ‹‰é€‰æ‹©æ¡†ç±»å‹
                    const select = document.getElementById(`opt_${opt}`);
                    const manualInput = document.getElementById(`opt_${opt}_manual`);
                    
                    if (select) {
                        const selectedValue = select.value.trim();
                        if (selectedValue && selectedValue !== '__manual__') {
                            // ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©çš„å€¼
                            parts.push(`--${opt} ${selectedValue}`);
                        } else if (selectedValue === '__manual__' && manualInput) {
                            // æ‰‹åŠ¨è¾“å…¥çš„å€¼
                            const manualValue = manualInput.value.trim();
                            if (manualValue) {
                                parts.push(`--${opt} ${manualValue}`);
                            }
                        }
                    }
                } else {
                    const input = document.getElementById(`opt_${opt}`);
                    if (input) {
                        if (input.type === 'checkbox') {
                            if (input.checked) {
                                parts.push(`--${opt}`);
                            }
                        } else {
                            const value = input.value.trim();
                            if (value) {
                                // display-traceçš„trace_idæ˜¯ä½ç½®å‚æ•°ï¼Œä¸æ˜¯é€‰é¡¹
                                if (mainCmd === 'display-trace' && opt === 'trace_id') {
                                    parts.push(value);
                                } else {
                                    parts.push(`--${opt} ${value}`);
                                }
                            }
                        }
                    }
                }
            });

            // æ„å»ºæœ€ç»ˆå‘½ä»¤
            command = 'obdiag ' + parts.join(' ');
            
            if (configs.length > 0) {
                configs.forEach(config => {
                    command += ` \\\n    --config ${config}`;
                });
            }

            // æ£€æŸ¥å¿…å¡«å‚æ•°
            const cmdStructForRequired = commandStructure[mainCmd];
            let requiredOptions = [];
            // ç‰¹æ®Šå¤„ç†ï¼šrca run + åœºæ™¯
            if (mainCmd === 'rca' && subCmd === 'run') {
                if (subSubCmd && subSubCmd !== '_manual_scene') {
                    // å·²é€‰æ‹©åœºæ™¯ï¼Œåœºæ™¯å·²è‡ªåŠ¨æ·»åŠ ï¼Œä¸éœ€è¦æ£€æŸ¥ scene å‚æ•°
                    if (cmdStructForRequired && cmdStructForRequired[subCmd] && cmdStructForRequired[subCmd][subSubCmd] && cmdStructForRequired[subCmd][subSubCmd].required) {
                        requiredOptions = cmdStructForRequired[subCmd][subSubCmd].required.filter(opt => opt !== 'scene');
                    }
                } else if (subSubCmd === '_manual_scene') {
                    // æ‰‹åŠ¨è¾“å…¥åœºæ™¯ï¼Œscene å‚æ•°å¿…å¡«
                    if (cmdStructForRequired && cmdStructForRequired[subCmd] && cmdStructForRequired[subCmd][subSubCmd] && cmdStructForRequired[subCmd][subSubCmd].required) {
                        requiredOptions = cmdStructForRequired[subCmd][subSubCmd].required;
                    }
                }
            }
            // ç‰¹æ®Šå¤„ç†ï¼šgather scene run + åœºæ™¯ï¼ˆå››çº§å‘½ä»¤ï¼‰
            else if (mainCmd === 'gather' && subCmd === 'scene' && subSubCmd === 'run') {
                if (subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                    // å·²é€‰æ‹©åœºæ™¯ï¼Œåœºæ™¯å·²è‡ªåŠ¨æ·»åŠ ï¼Œä¸éœ€è¦æ£€æŸ¥ scene å‚æ•°
                    if (cmdStructForRequired && cmdStructForRequired[subCmd] && cmdStructForRequired[subCmd][subSubCmd] && cmdStructForRequired[subCmd][subSubCmd].required) {
                        requiredOptions = cmdStructForRequired[subCmd][subSubCmd].required.filter(opt => opt !== 'scene');
                    }
                    // æ£€æŸ¥åœºæ™¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
                    const sceneInfo = gatherScenes[subSubSubCmd];
                    if (sceneInfo && sceneInfo.requiredEnv && sceneInfo.requiredEnv.length > 0) {
                        sceneInfo.requiredEnv.forEach(envVar => {
                            requiredOptions.push(`env_${envVar}`);
                        });
                    }
                } else if (subSubSubCmd === '_manual_scene') {
                    // æ‰‹åŠ¨è¾“å…¥åœºæ™¯ï¼Œscene å‚æ•°å¿…å¡«
                    if (cmdStructForRequired && cmdStructForRequired[subCmd] && cmdStructForRequired[subCmd][subSubCmd] && cmdStructForRequired[subCmd][subSubCmd].required) {
                        requiredOptions = cmdStructForRequired[subCmd][subSubCmd].required;
                    }
                }
            }
            // ç‰¹æ®Šå¤„ç†ï¼šdisplay scene run + åœºæ™¯ï¼ˆå››çº§å‘½ä»¤ï¼‰
            else if (mainCmd === 'display' && subCmd === 'scene' && subSubCmd === 'run') {
                if (subSubSubCmd && subSubSubCmd !== '_manual_scene') {
                    // å·²é€‰æ‹©åœºæ™¯ï¼Œåœºæ™¯å·²è‡ªåŠ¨æ·»åŠ ï¼Œä¸éœ€è¦æ£€æŸ¥ scene å‚æ•°
                    if (cmdStructForRequired && cmdStructForRequired[subCmd] && cmdStructForRequired[subCmd][subSubCmd] && cmdStructForRequired[subCmd][subSubCmd].required) {
                        requiredOptions = cmdStructForRequired[subCmd][subSubCmd].required.filter(opt => opt !== 'scene');
                    }
                    // æ£€æŸ¥åœºæ™¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
                    const sceneInfo = displayScenes[subSubSubCmd];
                    if (sceneInfo && sceneInfo.requiredEnv && sceneInfo.requiredEnv.length > 0) {
                        sceneInfo.requiredEnv.forEach(envVar => {
                            requiredOptions.push(`env_${envVar}`);
                        });
                    }
                } else if (subSubSubCmd === '_manual_scene') {
                    // æ‰‹åŠ¨è¾“å…¥åœºæ™¯ï¼Œscene å‚æ•°å¿…å¡«
                    if (cmdStructForRequired && cmdStructForRequired[subCmd] && cmdStructForRequired[subCmd][subSubCmd] && cmdStructForRequired[subCmd][subSubCmd].required) {
                        requiredOptions = cmdStructForRequired[subCmd][subSubCmd].required;
                    }
                }
            }
            else if (subSubCmd && subCmd && cmdStructForRequired && cmdStructForRequired[subCmd] && cmdStructForRequired[subCmd][subSubCmd] && cmdStructForRequired[subCmd][subSubCmd].required) {
                requiredOptions = cmdStructForRequired[subCmd][subSubCmd].required;
            } else if (subCmd && cmdStructForRequired && cmdStructForRequired[subCmd] && cmdStructForRequired[subCmd].required) {
                requiredOptions = cmdStructForRequired[subCmd].required;
            } else if (cmdStructForRequired && cmdStructForRequired.required) {
                requiredOptions = cmdStructForRequired.required;
            }
            
            let missingRequired = [];
            requiredOptions.forEach(reqOpt => {
                // ç‰¹æ®Šå¤„ç†ï¼šåœºæ™¯ç¯å¢ƒå˜é‡ï¼ˆæ ¼å¼ï¼šenv_<envVar>ï¼‰
                if (reqOpt.startsWith('env_')) {
                    const envVar = reqOpt.substring(4); // ç§»é™¤ 'env_' å‰ç¼€
                    const envInput = document.querySelector(`.scene-env-${envVar}`);
                    if (!envInput || !envInput.value.trim()) {
                        missingRequired.push(`--env ${envVar}=`);
                    }
                    return;
                }
                
                const desc = optionDescriptions[reqOpt] || {};
                if (desc.type === 'db_env') {
                    const container = document.getElementById(`opt_${reqOpt}_container`);
                    if (container) {
                        const host = container.querySelector('.db-env-host')?.value.trim();
                        const port = container.querySelector('.db-env-port')?.value.trim();
                        const user = container.querySelector('.db-env-user')?.value.trim();
                        const password = container.querySelector('.db-env-password')?.value.trim();
                        const database = container.querySelector('.db-env-database')?.value.trim();
                        if (!host || !port || !user || !password || !database) {
                            missingRequired.push(reqOpt);
                        }
                    } else {
                        missingRequired.push(reqOpt);
                    }
                } else if (desc.type === 'select') {
                    // å¤„ç†ä¸‹æ‹‰é€‰æ‹©æ¡†ç±»å‹çš„å¿…å¡«å‚æ•°
                    const select = document.getElementById(`opt_${reqOpt}`);
                    const manualInput = document.getElementById(`opt_${reqOpt}_manual`);
                    if (select) {
                        const selectedValue = select.value.trim();
                        if (!selectedValue || selectedValue === '__manual__') {
                            // å¦‚æœé€‰æ‹©äº†æ‰‹åŠ¨è¾“å…¥ï¼Œæ£€æŸ¥æ‰‹åŠ¨è¾“å…¥æ¡†
                            if (!manualInput || !manualInput.value.trim()) {
                                missingRequired.push(reqOpt);
                            }
                        }
                        // å¦‚æœé€‰æ‹©äº†æœ‰æ•ˆå€¼ï¼Œåˆ™ä¸éœ€è¦æ£€æŸ¥
                    } else {
                        missingRequired.push(reqOpt);
                    }
                } else {
                    const input = document.getElementById(`opt_${reqOpt}`);
                    if (!input || !input.value.trim()) {
                        missingRequired.push(reqOpt);
                    }
                }
            });
            
            if (missingRequired.length > 0) {
                const missingNames = missingRequired.map(opt => {
                    const desc = optionDescriptions[opt] || {};
                    return desc.label || opt;
                }).join(', ');
                command += '\n\nâš ï¸ è­¦å‘Š: ä»¥ä¸‹å¿…å¡«å‚æ•°æœªå¡«å†™: ' + missingNames;
            }
            
            document.getElementById('commandOutput').textContent = command || 'è¯·å¡«å†™é…ç½®...';
        }

        function copyCommand() {
            const commandText = document.getElementById('commandOutput').textContent;
            navigator.clipboard.writeText(commandText).then(() => {
                const alert = document.getElementById('copyAlert');
                alert.classList.remove('hidden');
                setTimeout(() => {
                    alert.classList.add('hidden');
                }, 2000);
            });
        }

        // ç›‘å¬æ‰€æœ‰è¾“å…¥å˜åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('input', updateCommandOutput);
                input.addEventListener('change', updateCommandOutput);
                
                // æ·»åŠ æ ¼å¼éªŒè¯
                if (input.id === 'observerSshUsername' || input.id === 'obproxySshUsername') {
                    input.addEventListener('blur', function() {
                        const value = this.value.trim();
                        if (value) {
                            const validation = validateUsername(value);
                            if (!validation.valid) {
                                showValidationError(this, validation.message);
                            } else {
                                clearValidationError(this);
                            }
                        } else {
                            clearValidationError(this);
                        }
                    });
                }
                
                if (input.classList.contains('node-ip') || input.classList.contains('proxy-node-ip')) {
                    input.addEventListener('blur', function() {
                        const value = this.value.trim();
                        if (value) {
                            if (!validateIP(value)) {
                                showValidationError(this, 'è¯·è¾“å…¥æœ‰æ•ˆçš„IPåœ°å€æ ¼å¼ï¼ˆä¾‹å¦‚: 192.168.1.1ï¼‰');
                            } else {
                                clearValidationError(this);
                            }
                        } else {
                            clearValidationError(this);
                        }
                    });
                }
                
                if (input.id === 'observerSshPort' || input.id === 'dbPort') {
                    input.addEventListener('blur', function() {
                        const value = this.value.trim();
                        if (value) {
                            if (!validatePort(value)) {
                                showValidationError(this, 'ç«¯å£å·å¿…é¡»åœ¨ 1-65535 ä¹‹é—´');
                            } else {
                                clearValidationError(this);
                            }
                        } else {
                            clearValidationError(this);
                        }
                    });
                }
            });
            
            // ç¡®ä¿ä¸»å‘½ä»¤é€‰æ‹©æ¡†çš„äº‹ä»¶ç»‘å®šæ­£ç¡®
            const mainCommandSelect = document.getElementById('mainCommand');
            if (mainCommandSelect) {
                mainCommandSelect.addEventListener('change', updateSubCommands);
            }
        });
    </script>
</body>
</html>